!function(I){var g={};function C(n){if(g[n])return g[n].exports;var t=g[n]={i:n,l:!1,exports:{}};return I[n].call(t.exports,t,t.exports,C),t.l=!0,t.exports}C.m=I,C.c=g,C.d=function(I,g,n){C.o(I,g)||Object.defineProperty(I,g,{enumerable:!0,get:n})},C.r=function(I){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})},C.t=function(I,g){if(1&g&&(I=C(I)),8&g)return I;if(4&g&&"object"==typeof I&&I&&I.__esModule)return I;var n=Object.create(null);if(C.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:I}),2&g&&"string"!=typeof I)for(var t in I)C.d(n,t,function(g){return I[g]}.bind(null,t));return n},C.n=function(I){var g=I&&I.__esModule?function(){return I.default}:function(){return I};return C.d(g,"a",g),g},C.o=function(I,g){return Object.prototype.hasOwnProperty.call(I,g)},C.p="",C(C.s=5)}({5:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./view/brainbox/src/tools/freeform.js\nfunction freeform(annotation, path, username) {\n    let tr; // the object that will go into the table\n    let obj; // the object that will go into the database\n\n    // configure table row\n    tr = "<td contentEditable=true class=\'noEmpty\'></td>";\n\n    // configure database object\n    obj = {\n        typeOfBinding:2,\n        path: path,\n        format: function(e, d) {\n            if(typeof d.data === \'undefined\') {\n                e.get(0).innerHTML = "";\n            } else {\n                e.get(0).innerHTML = \'<span>\'+d.data+\'</span>\';\n            }\n        },\n        parse: function(e, d) {\n            const obj = d;\n            obj.modified = (new Date()).toJSON();\n            obj.modifiedBy = username;\n            obj.data = e.get(0).textContent;\n            return obj;\n        }\n    };\n\n    return {tr, obj};\n}\n\n// CONCATENATED MODULE: ./view/brainbox/src/tools/hidden.js\nfunction hidden_freeform(annotation, path, username) {\n    let tr; // the object that will go into the table\n    let obj; // the object that will go into the database\n\n    // configure table row\n    tr = "<td contentEditable=true class=\'hidden\'></td>";\n\n    // configure database object\n    obj = {\n        typeOfBinding:2,\n        path: path,\n        format: function(e, d) {\n            if(typeof d.data === \'undefined\') {\n                e.get(0).innerHTML = "";\n            } else {\n                e.get(0).innerHTML = \'<span>\'+d.data+\'</span>\';\n            }\n        },\n        parse: function(e, d) {\n            const obj = d;\n            obj.modified = (new Date()).toJSON();\n            obj.modifiedBy = username;\n            obj.data = e.get(0).textContent;\n            return obj;\n        }\n    };\n\n    return {tr, obj};\n}\n\n// CONCATENATED MODULE: ./view/brainbox/src/tools/multiple.js\nfunction multiple(annotation, path, username) {\n    let tr = []; // the object that will go into the table\n    let obj; // the object that will go into the database\n    const values = annotation.values.split(/[, ]+/);\n\n    // configure table row\n    tr.push("<td><select value=0><option value=\'\' disabled selected hidden>Empty</option>");\n    for (var o in values) {\n        tr.push("<option value=\\"" + values[o] + "\\"" + ">" + values[o] + "</option>");\n    }\n    tr.push("</select></td>");\n    tr = tr.join("\\n");\n\n    // configure database object\n    obj = {\n        typeOfBinding:2,\n        path: path,\n        format: function(e, d) {\n            var obj = d;\n            if (typeof obj.data !== \'undefined\') {\n                /**\n                 * @todo Replace color assignment by the addition of a class\n                 */\n                e.get(0).querySelectorAll("select")[0].style.color = "#fff"; \n                e.get(0).querySelectorAll("select")[0].value = obj.data; \n            } else {\n                e.get(0).querySelectorAll("select")[0].value = ""; \n            }\n        },\n        parse: function(e, d) {\n            if (e.get(0).querySelectorAll("select")[0].value) {\n                e.get(0).querySelectorAll("select")[0].style.color = "#fff";\n            }\n            const obj = d;\n            obj.modified = (new Date()).toJSON();\n            obj.modifiedBy = username;\n            obj.data = e.get(0).querySelectorAll("select")[0].value;\n            return obj;\n        }\n    };\n\n    return {tr, obj};\n}\n\n\n\n// CONCATENATED MODULE: ./view/brainbox/src/pages/project-page.js\n\n\n\n\nconst projShortname = projectInfo.shortname;\nconst numFilesQuery = 20;\nconst annotations = {\n    text: [],   // collect text annotations\n    volume: []  // collect volume annotations\n};\nlet k, h, str, found, annType, annName, file;\nconst info_proxy = {};\nlet trTemplate;\nlet objTemplate;\nlet aParam;\nlet hashOld;\n\n\n// Prevent zoom on double tap\n$(\'body\').on(\'touchstart\', function preventZoom(e) {\n    var t2 = e.timeStamp\n      , t1 = $(this).data(\'lastTouch\') || t2\n      , dt = t2 - t1\n      , fingers = e.originalEvent.touches.length;\n    $(this).data(\'lastTouch\', t2);\n    if (!dt || dt > 500 || fingers > 1) return; // not double-tap\n    e.preventDefault(); // double tap - prevent the zoom\n    // also synthesize click events we just swallowed up\n    $(this).trigger(\'click\').trigger(\'click\');\n});\n\n// collect the project\'s text annotations\nfor(k=0;k<projectInfo.annotations.list.length;k++) {\n    if (projectInfo.annotations.list[k].type === "text" |\n        projectInfo.annotations.list[k].type === "hidden text" |\n        projectInfo.annotations.list[k].type === "multiple choices") {\n        $("#projectFiles thead tr").append("<th>" + projectInfo.annotations.list[k].name + "</th>");\n        annotations.text.push(projectInfo.annotations.list[k]);\n    }\n}\n// collect the project\'s volume annotations\nfor(k=0;k<projectInfo.annotations.list.length;k++) {\n    if (projectInfo.annotations.list[k].type === "volume") {\n        annotations.volume.push(projectInfo.annotations.list[k]);\n    }\n}\n\n$("#projectName").text(projectInfo.name);\n\n$("#resizeButton").data({flag:-1,x0:0,y0:0});\n$("#resizeButton").on(\'mousedown touchstart\',function(e){$(this).data({flag:0,x0:e.pageX,y0:e.pageY})});\n$("body").on(\'mousemove\',function(e){resizeButton({x:e.pageX,y:e.pageY})});\n$("body").on(\'touchmove\',function(e){resizeButton({x:e.originalEvent.changedTouches[0].pageX,y:e.originalEvent.changedTouches[0].pageY})});\n$("body").on(\'mouseup touchend\',function(e){$("#resizeButton").data({flag:-1})});\n\n$("#addProject").click(function(){location="/project/new"});\n$("#settings").click(function(){\n    var pathname=location.pathname;\n    if(pathname.slice(-1)=="/")\n        location=pathname+"settings";\n    else\n        location=pathname+"/settings";\n});\n\n\n// Init BrainBox\n//---------------\n    BrainBox.initBrainBox()\n    .then(function from_project(){\n        return BrainBox.loadLabelsets();\n    })\n    .then(function () {\n        // Bind the project\'s files to the table within #projectFiles\n        //------------------------------------------------------------\n        trTemplate = [\'<tr>\'];\n        objTemplate = [];\n\n        // configure the binding template for table row and object.\n        // the 1st two columns are fixed: name and source\n        trTemplate.push(["<td contentEditable=true class=\'noEmpty\'></td>"]);\n        objTemplate.push({ typeOfBinding: 2, path: "files.list.#.name"});\n\n        trTemplate.push(["<td><a></a></td>"]);\n        objTemplate.push({\n            typeOfBinding:1,\n            path:"files.list.#.source",\n            format:function(e, d){\n                $(e).find("a").prop("href", location.origin+"/mri?url=" + d);\n                $(e).find("a").html(d.split("/").pop());\n            }\n        });\n\n        // the following columns are completed from the project\'s \'annotations\' definitions:\n        // determine their type of display (either select or freeform at the moment) based data type\n        let g;\n        for(g=0; g<annotations.text.length; g++) {\n            // annType = Object.prototype.toString.call(annotations.text[g].values); // a better object type description\n            annType = annotations.text[g].type;\n            annName = annotations.text[g].name;\n\n            if(annType === "multiple choices") { // "[object Array]") {\n                // array of values\n                let {tr, obj} = multiple(\n                    annotations.text[g],\n                    "files.list.#.mri.annotations." + projShortname + "." + annName,\n                    AtlasMakerWidget.User.username\n                );\n                trTemplate.push(tr);\n                objTemplate.push(obj);\n            } else if(annType === "text") { //"[object String]" || annotations.text[g].values === "freeform") {\n                // freeform text\n                let {tr, obj} = freeform(\n                    annotations.text[g],\n                    "files.list.#.mri.annotations." + projShortname + "." + annName,\n                    AtlasMakerWidget.User.username\n                );\n                trTemplate.push(tr);\n                objTemplate.push(obj);\n            } else if(annType === "hidden text") { //"[object String]" || annotations.text[g].values === "freeform") {\n                // freeform text\n                let {tr, obj} = hidden_freeform(\n                    annotations.text[g],\n                    "files.list.#.mri.annotations." + projShortname + "." + annName,\n                    AtlasMakerWidget.User.username\n                );\n                trTemplate.push(tr);\n                objTemplate.push(obj);\n            }\n            /**\n             * @todo This is the place where \'position\' or \'length\' annotations should be added\n             */\n        }\n        trTemplate.push("</tr>");\n        aParam = {\n            table: $("#projectFiles table"),\n            info_proxy: info_proxy,\n            info: projectInfo,\n            trTemplate: trTemplate.join("\\n"),\n            objTemplate: objTemplate\n        };\n    })\n    .then(function() {\n\n        // Append the project files progressively. Start with the 1st #numFilesQuery files, load and\n        // display the 1st file, configure the tools position, and keep querying for the\n        // rest of the files\n        return $.getJSON("/project/json/"+projectInfo.shortname+"/files", {\n            start: 0,\n            length: numFilesQuery\n        })\n    })\n    .then(function(list) {\n        appendFilesToProject(list);\n        \n        // mark first row as selected\n        $("#projectFiles tbody tr:eq(0)").addClass("selected");\n    })\n    .then(function from_project(){return loadProjectFile(0)})\n    .then(function from_project(){\n        $("#tools-side").detach().appendTo(\'#tools\');\n        // connect colours close button\n        $(document).on(\'click touchstart\', "#labels-close", function(){$("#labelset").hide()});\n    })\n    .then(function() {\n        queryFiles();\n    })\n    .catch( err => {\n        $("#msgLog").html("ERROR: Can\'t load data. " + err);\n        console.error(err);\n    });\n\n// Listen to changes that trigger a metadata save\n//------------------------------------------------\n    // send data when focus is lost (on blur)\n    $(document).on(\'blur\', "#projectFiles table tbody td", function from_project(e) {\n        var index = $(e.target).closest(\'tr\').index();\n        JSON.stringify(info_proxy); // update content of projectInfo object from proxy by calling all getters\n        AtlasMakerWidget.sendSaveMetadataMessage(projectInfo.files.list[index]);\n    });\n    // blur when [enter] is clicked, to trigger data sending\n    $(document).on(\'keydown\', "#projectFiles table tbody td", function(e) {\n        if(e.which==13 && $(e.target).attr(\'contenteditable\')) {\n            e.preventDefault();\n            $(e.target).blur();\n        }\n    });\n    // blur when <select> changes value to trigger data sending\n    $("#projectFiles table tbody").on(\'change\', "select", function(e) {\n        $(e.target).blur();\n    });\n\n// Listen to changes in selected table row\n//----------------------------------------\n    // listen to changes in file selection by clicking on the file table\n    $(document).on(\'click touchstart\', "#projectFiles tbody tr",function() {\n        var table=$(this).closest("table");\n        var currentIndex=$(table).find("tr.selected").index();\n        var index=$(this).index();\n\n        if(index>=0 && currentIndex!=index) {\n            $(table).find("tr").removeClass("selected");\n            $(this).addClass("selected");\n            // remove table with previous annotations\n            $("table#volAnnotations tbody").html("");\n            // load and bind new file\n            loadProjectFile(index);\n        }\n    });\n\n    // listen to changes in file selection by pressing the up/down arrows\n    $(document).on(\'keydown\', function(e){\n        var table=$("#projectFiles tbody");\n        var index=$(table).find("tr.selected").index();\n    \n        if(e.keyCode!=38 && e.keyCode!=40)\n            return;\n\n        switch(e.keyCode) {\n            case 38: // up\n                index=(index+projectInfo.files.list.length-1)%projectInfo.files.list.length;\n                break;\n            case 40: // down\n                index=(index+1)%projectInfo.files.list.length;\n                break;\n        }\n        $(table).find("tr").removeClass("selected");\n        $(table).find("tr:eq("+index+")").addClass("selected");\n    \n        // remove table with previous annotations\n        $("table#volAnnotations tbody").html("");\n\n        // load and bind new file\n        loadProjectFile(index);\n    });\n\n    // listen to changes in selected volume annotation\n    $(document).on(\'click touchstart\', "#volAnnotations tbody tr", function () {\n        var table=$(this).closest("tbody");\n        var currentIndex=$(table).find("tr.selected").index();\n        var index=$(this).index();\n\n        if(index>=0 && currentIndex!=index) {\n            $(table).find("tr").removeClass("selected");\n            $(this).addClass("selected");\n    \n            var iarr,found=false;\n            for(iarr=0;iarr<BrainBox.info.mri.atlas.length;iarr++) {\n                if(BrainBox.info.mri.atlas[iarr].name==annotations.volume[index].name\n                    && BrainBox.info.mri.atlas[iarr].project==projectInfo.shortname) {\n                    found=true;\n                    break;\n                }\n            }\n            if(found)\n                AtlasMakerWidget.configureAtlasMaker(BrainBox.info,iarr);\n            else\n                console.log("ERROR: A quite unexpected one too...");\n        }\n    });\n\n// Functions\n//----------\nfunction queryFiles() {\n    $.getJSON("/project/json/"+projectInfo.shortname+"/files", {\n        start: projectInfo.files.list.length,\n        length: numFilesQuery\n    })\n    .then(function(list) {\n        if(list.length) {\n            appendFilesToProject(list);\n            queryFiles();\n        } else {\n            console.log("All files downloaded. Length:",projectInfo.files.list.length);\n        }\n    })\n}\nfunction appendFilesToProject(list) {\n    var i0, i, j;\n    \n    i0 = projectInfo.files.list.length;\n    projectInfo.files.list.push.apply(projectInfo.files.list, list);\n    \n    // make sure that all mri files have a text annotations object for the project\n    for(i=0;i<list.length;i++) {\n        file = projectInfo.files.list[i0+i];\n        if (!(file.mri)) {\n            file.mri = {};\n        }\n        if (!(file.mri.annotations)) {\n            file.mri.annotations = {};\n        }\n        if (!(file.mri.annotations[projShortname])) {\n            file.mri.annotations[projShortname] = {};\n        }\n    }\n    // initialise the relevant annotation entries in each mri file if required\n    for(i=0;i<list.length;i++) {\n        file = projectInfo.files.list[i0+i];\n        for(j=0;j<annotations.text.length;j++) {\n            annName = annotations.text[j].name;\n            if(!file.mri.annotations[projShortname][annName]) {\n                var date=new Date();\n                file.mri.annotations[projShortname][annName] = {\n                    created: date.toJSON(),\n                    modified: date.toJSON(),\n                    modifiedBy: AtlasMakerWidget.User.username,\n                    type: "text"\n                };\n            }\n        }\n    }\n    for(var i=0;i<list.length;i++) {\n        BrainBox.appendAnnotationTableRow(i0+i,aParam);\n    }\n}\n\n/**\n * @func loadProjectFile\n * @desc load a new mri from the project list\n */\nfunction loadProjectFile(index) {\n    return new Promise(function(resolve, reject) {\n        var url=projectInfo.files.list[index].source;\n        var params={url:url,view:"cor",slice:180,fullscreen:false};\n        $("#loadingIndicator p").text("Loading...");\n        $("#loadingIndicator").show();\n\n        /**\n         * @todo The mri entry may correspond to a file that has not been downloaded yet!\n         */\n        var info = projectInfo.files.list[index];\n\n        if($.isEmptyObject(info) === false) {\n            // check if the mri contains the required annotations\n            var irow; // index of the table row\n            var iarr; // index of the object in the data array\n            for(irow=0;irow<annotations.volume.length;irow++) {\n                found = false;\n                if(!info.mri.atlas)\n                    info.mri.atlas = [];\n                for(iarr=0;iarr<info.mri.atlas.length;iarr++) {\n                    if(annotations.volume[irow].name == info.mri.atlas[iarr].name\n                       && projectInfo.shortname == info.mri.atlas[iarr].project) {\n                        found=true;\n                        break;\n                    }\n                }\n                // if it doesn\'t, create them\n                if(found == false) {\n                    // add annotation\n                    var date=new Date();\n                    // add data to annotations array\n                    var atlas = {\n                        name: annotations.volume[irow].name,\n                        project: projectInfo.shortname,\n                        created: date.toJSON(),\n                        modified: date.toJSON(),\n                        modifiedBy: AtlasMakerWidget.User.username,\n                        filename: Math.random().toString(36).slice(2)+".nii.gz",\t// automatically generated filename\n                        labels: annotations.volume[irow].values,\n                        owner: AtlasMakerWidget.User.username,\n                        type: "volume"\n                    };\n\n                    projectInfo.files.list[index].mri.atlas.push(atlas);\n                }\n\n                annotations.volume[irow].annotationItemIndex=iarr;\n            }\n            params.info=projectInfo.files.list[index];\n\n            if(annotations.volume[0]) {\n                params.annotationItemIndex = annotations.volume[0].annotationItemIndex;\n            } else {\n                params.annotationItemIndex = -1;\n            }\n\n            BrainBox.configureBrainBox(params)\n            .then(function from_project(){\n\n                // bind volume annotations to table#volAnnotations\n                var annvol_proxy={};\n                var aParam = {\n                    table: $("table#volAnnotations"),\n                    info_proxy: annvol_proxy,\n                    info: BrainBox.info,\n                    trTemplate: $.map([\n                        "<tr>",\n                        " <td></td>",           // volume name\n                        " <td></td>",\t        // volume label set\n                        "</tr>"],function(o){return o}).join(),\n                    objTemplate: [\n                        {\ttypeOfBinding:1,\n                            path:"mri.atlas.#.name"\n                        },\n                        {\ttypeOfBinding:1,\n                            path:"mri.atlas.#.labels"\n                        }\n                    ]\n                };\n\n                // add and bind new table row\n                for(irow=0;irow<annotations.volume.length;irow++) {\n                    BrainBox.appendAnnotationTableRow2(irow,annotations.volume[irow].annotationItemIndex,aParam);\n                }\n                // update in server\n                saveAnnotations(aParam);\n\n                // select the first annotation by default\n                // (should be read from project settings)\n                $("#annotations tbody tr:eq(0)").addClass("selected");\n\n                AtlasMakerWidget.User.projectPage = projectInfo.shortname;\n                AtlasMakerWidget.sendUserDataMessage(JSON.stringify({projectPage:projectInfo.shortname}));\n\n                resolve();\n            });\n        } else {\n            var msg=AtlasMakerWidget.container.find("#text-layer");\n            msg.html("<text x=\'5\' y=\'15\' fill=\'white\'>ERROR: File is unreadable</text>");\n            console.log("ERROR: Cannot read data. The file is maybe corrupt?");\n\n            reject();\n        }\n    });\n}\nfunction saveAnnotations(param) {\n    JSON.stringify(param.info_proxy); // update BrainBox.info from info_proxy\n    AtlasMakerWidget.sendSaveMetadataMessage(BrainBox.info);\n    hashOld=BrainBox.hash(JSON.stringify(BrainBox.info));\n}\n/**\n * @func resizeButton\n * @desc Resize left tool bar\n */\nfunction resizeButton(p) {\n    if($("#resizeButton").data("flag")==0) {\n        $("#resizeButton").data({flag:1,x0:p.x,y0:p.y});\n    } else if($("#resizeButton").data("flag")==1) {\n        var d=$("#resizeButton").data("x0")-p.x;\n        $("#left").css({\'flex-basis\':$("#left").width()-d});\n        $("#resizeButton").data({x0:p.x,y0:p.y});\n        AtlasMakerWidget.resizeWindow();\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi92aWV3L2JyYWluYm94L3NyYy90b29scy9mcmVlZm9ybS5qcz81MzgzIiwid2VicGFjazovLy8uL3ZpZXcvYnJhaW5ib3gvc3JjL3Rvb2xzL2hpZGRlbi5qcz83NWY4Iiwid2VicGFjazovLy8uL3ZpZXcvYnJhaW5ib3gvc3JjL3Rvb2xzL211bHRpcGxlLmpzP2FhZTAiLCJ3ZWJwYWNrOi8vLy4vdmlldy9icmFpbmJveC9zcmMvcGFnZXMvcHJvamVjdC1wYWdlLmpzPzgwMGMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQWU7QUFDZixXQUFXO0FBQ1gsWUFBWTs7QUFFWjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxZQUFZO0FBQ1o7OztBQzVCZSxTQUFTLGVBQVE7QUFDaEMsV0FBVztBQUNYLFlBQVk7O0FBRVo7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsWUFBWTtBQUNaOzs7QUM1QmU7QUFDZixnQkFBZ0I7QUFDaEIsWUFBWTtBQUNaOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEU7QUFDQSx3RTtBQUNBLGFBQWE7QUFDYixrRTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsWUFBWTtBQUNaOzs7OztBQzFDNEM7QUFDSjtBQUNJOztBQUU1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBLFFBQVEsc0NBQXNDO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNDQUFzQztBQUM5QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSx5QkFBeUIsa0JBQWtCO0FBQzNDLHlEQUF5RCxjQUFjLDZCQUE2QixFQUFFO0FBQ3RHLHFDQUFxQyxjQUFjLG9CQUFvQixFQUFFO0FBQ3pFLHFDQUFxQyxjQUFjLG9GQUFvRixFQUFFO0FBQ3pJLDRDQUE0Qyx5QkFBeUIsUUFBUSxFQUFFOztBQUUvRSxrQ0FBa0Msd0JBQXdCO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsNkNBQTZDOztBQUV2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMkJBQTJCO0FBQzNDLG9GQUFvRjtBQUNwRjtBQUNBOztBQUVBLGdEQUFnRDtBQUNoRDtBQUNBLHFCQUFxQixRQUFRLEdBQUcsUUFBUTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLDhCQUE4QjtBQUMzQztBQUNBLHFCQUFxQixRQUFRLEdBQUcsUUFBUTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLHFDQUFxQztBQUNsRDtBQUNBLHFCQUFxQixRQUFRLEdBQUcsZUFBTTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxrQ0FBa0MsMEJBQTBCO0FBQzVEO0FBQ0E7QUFDQTtBQUNBLHVFQUF1RSxzQkFBc0I7QUFDN0YsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DO0FBQ25DO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHVCQUF1QixvQ0FBb0M7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxZQUFZLGNBQWM7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxjQUFjO0FBQzFCO0FBQ0EsZ0JBQWdCLDBCQUEwQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsY0FBYztBQUM5QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLHFCQUFxQjtBQUNyQix1QkFBdUIsK0JBQStCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiwyQkFBMkI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsU0FBUztBQUN0RDtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBLHlCQUF5QjtBQUN6Qix5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwyQkFBMkIsK0JBQStCO0FBQzFEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHFFQUFxRSxrQ0FBa0M7O0FBRXZHO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxxQkFBcUI7QUFDdEQsS0FBSztBQUNMO0FBQ0Esd0JBQXdCLGtDQUFrQztBQUMxRCxpQ0FBaUMsY0FBYztBQUMvQztBQUNBO0FBQ0EiLCJmaWxlIjoiNS5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGZyZWVmb3JtKGFubm90YXRpb24sIHBhdGgsIHVzZXJuYW1lKSB7XG4gICAgbGV0IHRyOyAvLyB0aGUgb2JqZWN0IHRoYXQgd2lsbCBnbyBpbnRvIHRoZSB0YWJsZVxuICAgIGxldCBvYmo7IC8vIHRoZSBvYmplY3QgdGhhdCB3aWxsIGdvIGludG8gdGhlIGRhdGFiYXNlXG5cbiAgICAvLyBjb25maWd1cmUgdGFibGUgcm93XG4gICAgdHIgPSBcIjx0ZCBjb250ZW50RWRpdGFibGU9dHJ1ZSBjbGFzcz0nbm9FbXB0eSc+PC90ZD5cIjtcblxuICAgIC8vIGNvbmZpZ3VyZSBkYXRhYmFzZSBvYmplY3RcbiAgICBvYmogPSB7XG4gICAgICAgIHR5cGVPZkJpbmRpbmc6MixcbiAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgZm9ybWF0OiBmdW5jdGlvbihlLCBkKSB7XG4gICAgICAgICAgICBpZih0eXBlb2YgZC5kYXRhID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGUuZ2V0KDApLmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGUuZ2V0KDApLmlubmVySFRNTCA9ICc8c3Bhbj4nK2QuZGF0YSsnPC9zcGFuPic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBhcnNlOiBmdW5jdGlvbihlLCBkKSB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBkO1xuICAgICAgICAgICAgb2JqLm1vZGlmaWVkID0gKG5ldyBEYXRlKCkpLnRvSlNPTigpO1xuICAgICAgICAgICAgb2JqLm1vZGlmaWVkQnkgPSB1c2VybmFtZTtcbiAgICAgICAgICAgIG9iai5kYXRhID0gZS5nZXQoMCkudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiB7dHIsIG9ian07XG59XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBmcmVlZm9ybShhbm5vdGF0aW9uLCBwYXRoLCB1c2VybmFtZSkge1xuICAgIGxldCB0cjsgLy8gdGhlIG9iamVjdCB0aGF0IHdpbGwgZ28gaW50byB0aGUgdGFibGVcbiAgICBsZXQgb2JqOyAvLyB0aGUgb2JqZWN0IHRoYXQgd2lsbCBnbyBpbnRvIHRoZSBkYXRhYmFzZVxuXG4gICAgLy8gY29uZmlndXJlIHRhYmxlIHJvd1xuICAgIHRyID0gXCI8dGQgY29udGVudEVkaXRhYmxlPXRydWUgY2xhc3M9J2hpZGRlbic+PC90ZD5cIjtcblxuICAgIC8vIGNvbmZpZ3VyZSBkYXRhYmFzZSBvYmplY3RcbiAgICBvYmogPSB7XG4gICAgICAgIHR5cGVPZkJpbmRpbmc6MixcbiAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgZm9ybWF0OiBmdW5jdGlvbihlLCBkKSB7XG4gICAgICAgICAgICBpZih0eXBlb2YgZC5kYXRhID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGUuZ2V0KDApLmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGUuZ2V0KDApLmlubmVySFRNTCA9ICc8c3Bhbj4nK2QuZGF0YSsnPC9zcGFuPic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBhcnNlOiBmdW5jdGlvbihlLCBkKSB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSBkO1xuICAgICAgICAgICAgb2JqLm1vZGlmaWVkID0gKG5ldyBEYXRlKCkpLnRvSlNPTigpO1xuICAgICAgICAgICAgb2JqLm1vZGlmaWVkQnkgPSB1c2VybmFtZTtcbiAgICAgICAgICAgIG9iai5kYXRhID0gZS5nZXQoMCkudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiB7dHIsIG9ian07XG59XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBtdWx0aXBsZShhbm5vdGF0aW9uLCBwYXRoLCB1c2VybmFtZSkge1xuICAgIGxldCB0ciA9IFtdOyAvLyB0aGUgb2JqZWN0IHRoYXQgd2lsbCBnbyBpbnRvIHRoZSB0YWJsZVxuICAgIGxldCBvYmo7IC8vIHRoZSBvYmplY3QgdGhhdCB3aWxsIGdvIGludG8gdGhlIGRhdGFiYXNlXG4gICAgY29uc3QgdmFsdWVzID0gYW5ub3RhdGlvbi52YWx1ZXMuc3BsaXQoL1ssIF0rLyk7XG5cbiAgICAvLyBjb25maWd1cmUgdGFibGUgcm93XG4gICAgdHIucHVzaChcIjx0ZD48c2VsZWN0IHZhbHVlPTA+PG9wdGlvbiB2YWx1ZT0nJyBkaXNhYmxlZCBzZWxlY3RlZCBoaWRkZW4+RW1wdHk8L29wdGlvbj5cIik7XG4gICAgZm9yICh2YXIgbyBpbiB2YWx1ZXMpIHtcbiAgICAgICAgdHIucHVzaChcIjxvcHRpb24gdmFsdWU9XFxcIlwiICsgdmFsdWVzW29dICsgXCJcXFwiXCIgKyBcIj5cIiArIHZhbHVlc1tvXSArIFwiPC9vcHRpb24+XCIpO1xuICAgIH1cbiAgICB0ci5wdXNoKFwiPC9zZWxlY3Q+PC90ZD5cIik7XG4gICAgdHIgPSB0ci5qb2luKFwiXFxuXCIpO1xuXG4gICAgLy8gY29uZmlndXJlIGRhdGFiYXNlIG9iamVjdFxuICAgIG9iaiA9IHtcbiAgICAgICAgdHlwZU9mQmluZGluZzoyLFxuICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uKGUsIGQpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBkO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmouZGF0YSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBAdG9kbyBSZXBsYWNlIGNvbG9yIGFzc2lnbm1lbnQgYnkgdGhlIGFkZGl0aW9uIG9mIGEgY2xhc3NcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBlLmdldCgwKS5xdWVyeVNlbGVjdG9yQWxsKFwic2VsZWN0XCIpWzBdLnN0eWxlLmNvbG9yID0gXCIjZmZmXCI7IFxuICAgICAgICAgICAgICAgIGUuZ2V0KDApLnF1ZXJ5U2VsZWN0b3JBbGwoXCJzZWxlY3RcIilbMF0udmFsdWUgPSBvYmouZGF0YTsgXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGUuZ2V0KDApLnF1ZXJ5U2VsZWN0b3JBbGwoXCJzZWxlY3RcIilbMF0udmFsdWUgPSBcIlwiOyBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uKGUsIGQpIHtcbiAgICAgICAgICAgIGlmIChlLmdldCgwKS5xdWVyeVNlbGVjdG9yQWxsKFwic2VsZWN0XCIpWzBdLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZS5nZXQoMCkucXVlcnlTZWxlY3RvckFsbChcInNlbGVjdFwiKVswXS5zdHlsZS5jb2xvciA9IFwiI2ZmZlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgb2JqID0gZDtcbiAgICAgICAgICAgIG9iai5tb2RpZmllZCA9IChuZXcgRGF0ZSgpKS50b0pTT04oKTtcbiAgICAgICAgICAgIG9iai5tb2RpZmllZEJ5ID0gdXNlcm5hbWU7XG4gICAgICAgICAgICBvYmouZGF0YSA9IGUuZ2V0KDApLnF1ZXJ5U2VsZWN0b3JBbGwoXCJzZWxlY3RcIilbMF0udmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiB7dHIsIG9ian07XG59XG5cblxuIiwiaW1wb3J0IGZyZWVmb3JtIGZyb20gJy4uL3Rvb2xzL2ZyZWVmb3JtLmpzJztcbmltcG9ydCBoaWRkZW4gZnJvbSAnLi4vdG9vbHMvaGlkZGVuLmpzJztcbmltcG9ydCBtdWx0aXBsZSBmcm9tICcuLi90b29scy9tdWx0aXBsZS5qcyc7XG5cbmNvbnN0IHByb2pTaG9ydG5hbWUgPSBwcm9qZWN0SW5mby5zaG9ydG5hbWU7XG5jb25zdCBudW1GaWxlc1F1ZXJ5ID0gMjA7XG5jb25zdCBhbm5vdGF0aW9ucyA9IHtcbiAgICB0ZXh0OiBbXSwgICAvLyBjb2xsZWN0IHRleHQgYW5ub3RhdGlvbnNcbiAgICB2b2x1bWU6IFtdICAvLyBjb2xsZWN0IHZvbHVtZSBhbm5vdGF0aW9uc1xufTtcbmxldCBrLCBoLCBzdHIsIGZvdW5kLCBhbm5UeXBlLCBhbm5OYW1lLCBmaWxlO1xuY29uc3QgaW5mb19wcm94eSA9IHt9O1xubGV0IHRyVGVtcGxhdGU7XG5sZXQgb2JqVGVtcGxhdGU7XG5sZXQgYVBhcmFtO1xubGV0IGhhc2hPbGQ7XG5cblxuLy8gUHJldmVudCB6b29tIG9uIGRvdWJsZSB0YXBcbiQoJ2JvZHknKS5vbigndG91Y2hzdGFydCcsIGZ1bmN0aW9uIHByZXZlbnRab29tKGUpIHtcbiAgICB2YXIgdDIgPSBlLnRpbWVTdGFtcFxuICAgICAgLCB0MSA9ICQodGhpcykuZGF0YSgnbGFzdFRvdWNoJykgfHwgdDJcbiAgICAgICwgZHQgPSB0MiAtIHQxXG4gICAgICAsIGZpbmdlcnMgPSBlLm9yaWdpbmFsRXZlbnQudG91Y2hlcy5sZW5ndGg7XG4gICAgJCh0aGlzKS5kYXRhKCdsYXN0VG91Y2gnLCB0Mik7XG4gICAgaWYgKCFkdCB8fCBkdCA+IDUwMCB8fCBmaW5nZXJzID4gMSkgcmV0dXJuOyAvLyBub3QgZG91YmxlLXRhcFxuICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gZG91YmxlIHRhcCAtIHByZXZlbnQgdGhlIHpvb21cbiAgICAvLyBhbHNvIHN5bnRoZXNpemUgY2xpY2sgZXZlbnRzIHdlIGp1c3Qgc3dhbGxvd2VkIHVwXG4gICAgJCh0aGlzKS50cmlnZ2VyKCdjbGljaycpLnRyaWdnZXIoJ2NsaWNrJyk7XG59KTtcblxuLy8gY29sbGVjdCB0aGUgcHJvamVjdCdzIHRleHQgYW5ub3RhdGlvbnNcbmZvcihrPTA7azxwcm9qZWN0SW5mby5hbm5vdGF0aW9ucy5saXN0Lmxlbmd0aDtrKyspIHtcbiAgICBpZiAocHJvamVjdEluZm8uYW5ub3RhdGlvbnMubGlzdFtrXS50eXBlID09PSBcInRleHRcIiB8XG4gICAgICAgIHByb2plY3RJbmZvLmFubm90YXRpb25zLmxpc3Rba10udHlwZSA9PT0gXCJoaWRkZW4gdGV4dFwiIHxcbiAgICAgICAgcHJvamVjdEluZm8uYW5ub3RhdGlvbnMubGlzdFtrXS50eXBlID09PSBcIm11bHRpcGxlIGNob2ljZXNcIikge1xuICAgICAgICAkKFwiI3Byb2plY3RGaWxlcyB0aGVhZCB0clwiKS5hcHBlbmQoXCI8dGg+XCIgKyBwcm9qZWN0SW5mby5hbm5vdGF0aW9ucy5saXN0W2tdLm5hbWUgKyBcIjwvdGg+XCIpO1xuICAgICAgICBhbm5vdGF0aW9ucy50ZXh0LnB1c2gocHJvamVjdEluZm8uYW5ub3RhdGlvbnMubGlzdFtrXSk7XG4gICAgfVxufVxuLy8gY29sbGVjdCB0aGUgcHJvamVjdCdzIHZvbHVtZSBhbm5vdGF0aW9uc1xuZm9yKGs9MDtrPHByb2plY3RJbmZvLmFubm90YXRpb25zLmxpc3QubGVuZ3RoO2srKykge1xuICAgIGlmIChwcm9qZWN0SW5mby5hbm5vdGF0aW9ucy5saXN0W2tdLnR5cGUgPT09IFwidm9sdW1lXCIpIHtcbiAgICAgICAgYW5ub3RhdGlvbnMudm9sdW1lLnB1c2gocHJvamVjdEluZm8uYW5ub3RhdGlvbnMubGlzdFtrXSk7XG4gICAgfVxufVxuXG4kKFwiI3Byb2plY3ROYW1lXCIpLnRleHQocHJvamVjdEluZm8ubmFtZSk7XG5cbiQoXCIjcmVzaXplQnV0dG9uXCIpLmRhdGEoe2ZsYWc6LTEseDA6MCx5MDowfSk7XG4kKFwiI3Jlc2l6ZUJ1dHRvblwiKS5vbignbW91c2Vkb3duIHRvdWNoc3RhcnQnLGZ1bmN0aW9uKGUpeyQodGhpcykuZGF0YSh7ZmxhZzowLHgwOmUucGFnZVgseTA6ZS5wYWdlWX0pfSk7XG4kKFwiYm9keVwiKS5vbignbW91c2Vtb3ZlJyxmdW5jdGlvbihlKXtyZXNpemVCdXR0b24oe3g6ZS5wYWdlWCx5OmUucGFnZVl9KX0pO1xuJChcImJvZHlcIikub24oJ3RvdWNobW92ZScsZnVuY3Rpb24oZSl7cmVzaXplQnV0dG9uKHt4OmUub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCx5OmUub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWX0pfSk7XG4kKFwiYm9keVwiKS5vbignbW91c2V1cCB0b3VjaGVuZCcsZnVuY3Rpb24oZSl7JChcIiNyZXNpemVCdXR0b25cIikuZGF0YSh7ZmxhZzotMX0pfSk7XG5cbiQoXCIjYWRkUHJvamVjdFwiKS5jbGljayhmdW5jdGlvbigpe2xvY2F0aW9uPVwiL3Byb2plY3QvbmV3XCJ9KTtcbiQoXCIjc2V0dGluZ3NcIikuY2xpY2soZnVuY3Rpb24oKXtcbiAgICB2YXIgcGF0aG5hbWU9bG9jYXRpb24ucGF0aG5hbWU7XG4gICAgaWYocGF0aG5hbWUuc2xpY2UoLTEpPT1cIi9cIilcbiAgICAgICAgbG9jYXRpb249cGF0aG5hbWUrXCJzZXR0aW5nc1wiO1xuICAgIGVsc2VcbiAgICAgICAgbG9jYXRpb249cGF0aG5hbWUrXCIvc2V0dGluZ3NcIjtcbn0pO1xuXG5cbi8vIEluaXQgQnJhaW5Cb3hcbi8vLS0tLS0tLS0tLS0tLS0tXG4gICAgQnJhaW5Cb3guaW5pdEJyYWluQm94KClcbiAgICAudGhlbihmdW5jdGlvbiBmcm9tX3Byb2plY3QoKXtcbiAgICAgICAgcmV0dXJuIEJyYWluQm94LmxvYWRMYWJlbHNldHMoKTtcbiAgICB9KVxuICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gQmluZCB0aGUgcHJvamVjdCdzIGZpbGVzIHRvIHRoZSB0YWJsZSB3aXRoaW4gI3Byb2plY3RGaWxlc1xuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICB0clRlbXBsYXRlID0gWyc8dHI+J107XG4gICAgICAgIG9ialRlbXBsYXRlID0gW107XG5cbiAgICAgICAgLy8gY29uZmlndXJlIHRoZSBiaW5kaW5nIHRlbXBsYXRlIGZvciB0YWJsZSByb3cgYW5kIG9iamVjdC5cbiAgICAgICAgLy8gdGhlIDFzdCB0d28gY29sdW1ucyBhcmUgZml4ZWQ6IG5hbWUgYW5kIHNvdXJjZVxuICAgICAgICB0clRlbXBsYXRlLnB1c2goW1wiPHRkIGNvbnRlbnRFZGl0YWJsZT10cnVlIGNsYXNzPSdub0VtcHR5Jz48L3RkPlwiXSk7XG4gICAgICAgIG9ialRlbXBsYXRlLnB1c2goeyB0eXBlT2ZCaW5kaW5nOiAyLCBwYXRoOiBcImZpbGVzLmxpc3QuIy5uYW1lXCJ9KTtcblxuICAgICAgICB0clRlbXBsYXRlLnB1c2goW1wiPHRkPjxhPjwvYT48L3RkPlwiXSk7XG4gICAgICAgIG9ialRlbXBsYXRlLnB1c2goe1xuICAgICAgICAgICAgdHlwZU9mQmluZGluZzoxLFxuICAgICAgICAgICAgcGF0aDpcImZpbGVzLmxpc3QuIy5zb3VyY2VcIixcbiAgICAgICAgICAgIGZvcm1hdDpmdW5jdGlvbihlLCBkKXtcbiAgICAgICAgICAgICAgICAkKGUpLmZpbmQoXCJhXCIpLnByb3AoXCJocmVmXCIsIGxvY2F0aW9uLm9yaWdpbitcIi9tcmk/dXJsPVwiICsgZCk7XG4gICAgICAgICAgICAgICAgJChlKS5maW5kKFwiYVwiKS5odG1sKGQuc3BsaXQoXCIvXCIpLnBvcCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gdGhlIGZvbGxvd2luZyBjb2x1bW5zIGFyZSBjb21wbGV0ZWQgZnJvbSB0aGUgcHJvamVjdCdzICdhbm5vdGF0aW9ucycgZGVmaW5pdGlvbnM6XG4gICAgICAgIC8vIGRldGVybWluZSB0aGVpciB0eXBlIG9mIGRpc3BsYXkgKGVpdGhlciBzZWxlY3Qgb3IgZnJlZWZvcm0gYXQgdGhlIG1vbWVudCkgYmFzZWQgZGF0YSB0eXBlXG4gICAgICAgIGxldCBnO1xuICAgICAgICBmb3IoZz0wOyBnPGFubm90YXRpb25zLnRleHQubGVuZ3RoOyBnKyspIHtcbiAgICAgICAgICAgIC8vIGFublR5cGUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYW5ub3RhdGlvbnMudGV4dFtnXS52YWx1ZXMpOyAvLyBhIGJldHRlciBvYmplY3QgdHlwZSBkZXNjcmlwdGlvblxuICAgICAgICAgICAgYW5uVHlwZSA9IGFubm90YXRpb25zLnRleHRbZ10udHlwZTtcbiAgICAgICAgICAgIGFubk5hbWUgPSBhbm5vdGF0aW9ucy50ZXh0W2ddLm5hbWU7XG5cbiAgICAgICAgICAgIGlmKGFublR5cGUgPT09IFwibXVsdGlwbGUgY2hvaWNlc1wiKSB7IC8vIFwiW29iamVjdCBBcnJheV1cIikge1xuICAgICAgICAgICAgICAgIC8vIGFycmF5IG9mIHZhbHVlc1xuICAgICAgICAgICAgICAgIGxldCB7dHIsIG9ian0gPSBtdWx0aXBsZShcbiAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvbnMudGV4dFtnXSxcbiAgICAgICAgICAgICAgICAgICAgXCJmaWxlcy5saXN0LiMubXJpLmFubm90YXRpb25zLlwiICsgcHJvalNob3J0bmFtZSArIFwiLlwiICsgYW5uTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgQXRsYXNNYWtlcldpZGdldC5Vc2VyLnVzZXJuYW1lXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0clRlbXBsYXRlLnB1c2godHIpO1xuICAgICAgICAgICAgICAgIG9ialRlbXBsYXRlLnB1c2gob2JqKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZihhbm5UeXBlID09PSBcInRleHRcIikgeyAvL1wiW29iamVjdCBTdHJpbmddXCIgfHwgYW5ub3RhdGlvbnMudGV4dFtnXS52YWx1ZXMgPT09IFwiZnJlZWZvcm1cIikge1xuICAgICAgICAgICAgICAgIC8vIGZyZWVmb3JtIHRleHRcbiAgICAgICAgICAgICAgICBsZXQge3RyLCBvYmp9ID0gZnJlZWZvcm0oXG4gICAgICAgICAgICAgICAgICAgIGFubm90YXRpb25zLnRleHRbZ10sXG4gICAgICAgICAgICAgICAgICAgIFwiZmlsZXMubGlzdC4jLm1yaS5hbm5vdGF0aW9ucy5cIiArIHByb2pTaG9ydG5hbWUgKyBcIi5cIiArIGFubk5hbWUsXG4gICAgICAgICAgICAgICAgICAgIEF0bGFzTWFrZXJXaWRnZXQuVXNlci51c2VybmFtZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdHJUZW1wbGF0ZS5wdXNoKHRyKTtcbiAgICAgICAgICAgICAgICBvYmpUZW1wbGF0ZS5wdXNoKG9iaik7XG4gICAgICAgICAgICB9IGVsc2UgaWYoYW5uVHlwZSA9PT0gXCJoaWRkZW4gdGV4dFwiKSB7IC8vXCJbb2JqZWN0IFN0cmluZ11cIiB8fCBhbm5vdGF0aW9ucy50ZXh0W2ddLnZhbHVlcyA9PT0gXCJmcmVlZm9ybVwiKSB7XG4gICAgICAgICAgICAgICAgLy8gZnJlZWZvcm0gdGV4dFxuICAgICAgICAgICAgICAgIGxldCB7dHIsIG9ian0gPSBoaWRkZW4oXG4gICAgICAgICAgICAgICAgICAgIGFubm90YXRpb25zLnRleHRbZ10sXG4gICAgICAgICAgICAgICAgICAgIFwiZmlsZXMubGlzdC4jLm1yaS5hbm5vdGF0aW9ucy5cIiArIHByb2pTaG9ydG5hbWUgKyBcIi5cIiArIGFubk5hbWUsXG4gICAgICAgICAgICAgICAgICAgIEF0bGFzTWFrZXJXaWRnZXQuVXNlci51c2VybmFtZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdHJUZW1wbGF0ZS5wdXNoKHRyKTtcbiAgICAgICAgICAgICAgICBvYmpUZW1wbGF0ZS5wdXNoKG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEB0b2RvIFRoaXMgaXMgdGhlIHBsYWNlIHdoZXJlICdwb3NpdGlvbicgb3IgJ2xlbmd0aCcgYW5ub3RhdGlvbnMgc2hvdWxkIGJlIGFkZGVkXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgfVxuICAgICAgICB0clRlbXBsYXRlLnB1c2goXCI8L3RyPlwiKTtcbiAgICAgICAgYVBhcmFtID0ge1xuICAgICAgICAgICAgdGFibGU6ICQoXCIjcHJvamVjdEZpbGVzIHRhYmxlXCIpLFxuICAgICAgICAgICAgaW5mb19wcm94eTogaW5mb19wcm94eSxcbiAgICAgICAgICAgIGluZm86IHByb2plY3RJbmZvLFxuICAgICAgICAgICAgdHJUZW1wbGF0ZTogdHJUZW1wbGF0ZS5qb2luKFwiXFxuXCIpLFxuICAgICAgICAgICAgb2JqVGVtcGxhdGU6IG9ialRlbXBsYXRlXG4gICAgICAgIH07XG4gICAgfSlcbiAgICAudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAvLyBBcHBlbmQgdGhlIHByb2plY3QgZmlsZXMgcHJvZ3Jlc3NpdmVseS4gU3RhcnQgd2l0aCB0aGUgMXN0ICNudW1GaWxlc1F1ZXJ5IGZpbGVzLCBsb2FkIGFuZFxuICAgICAgICAvLyBkaXNwbGF5IHRoZSAxc3QgZmlsZSwgY29uZmlndXJlIHRoZSB0b29scyBwb3NpdGlvbiwgYW5kIGtlZXAgcXVlcnlpbmcgZm9yIHRoZVxuICAgICAgICAvLyByZXN0IG9mIHRoZSBmaWxlc1xuICAgICAgICByZXR1cm4gJC5nZXRKU09OKFwiL3Byb2plY3QvanNvbi9cIitwcm9qZWN0SW5mby5zaG9ydG5hbWUrXCIvZmlsZXNcIiwge1xuICAgICAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgICAgICBsZW5ndGg6IG51bUZpbGVzUXVlcnlcbiAgICAgICAgfSlcbiAgICB9KVxuICAgIC50aGVuKGZ1bmN0aW9uKGxpc3QpIHtcbiAgICAgICAgYXBwZW5kRmlsZXNUb1Byb2plY3QobGlzdCk7XG4gICAgICAgIFxuICAgICAgICAvLyBtYXJrIGZpcnN0IHJvdyBhcyBzZWxlY3RlZFxuICAgICAgICAkKFwiI3Byb2plY3RGaWxlcyB0Ym9keSB0cjplcSgwKVwiKS5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24gZnJvbV9wcm9qZWN0KCl7cmV0dXJuIGxvYWRQcm9qZWN0RmlsZSgwKX0pXG4gICAgLnRoZW4oZnVuY3Rpb24gZnJvbV9wcm9qZWN0KCl7XG4gICAgICAgICQoXCIjdG9vbHMtc2lkZVwiKS5kZXRhY2goKS5hcHBlbmRUbygnI3Rvb2xzJyk7XG4gICAgICAgIC8vIGNvbm5lY3QgY29sb3VycyBjbG9zZSBidXR0b25cbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrIHRvdWNoc3RhcnQnLCBcIiNsYWJlbHMtY2xvc2VcIiwgZnVuY3Rpb24oKXskKFwiI2xhYmVsc2V0XCIpLmhpZGUoKX0pO1xuICAgIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIHF1ZXJ5RmlsZXMoKTtcbiAgICB9KVxuICAgIC5jYXRjaCggZXJyID0+IHtcbiAgICAgICAgJChcIiNtc2dMb2dcIikuaHRtbChcIkVSUk9SOiBDYW4ndCBsb2FkIGRhdGEuIFwiICsgZXJyKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pO1xuXG4vLyBMaXN0ZW4gdG8gY2hhbmdlcyB0aGF0IHRyaWdnZXIgYSBtZXRhZGF0YSBzYXZlXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIHNlbmQgZGF0YSB3aGVuIGZvY3VzIGlzIGxvc3QgKG9uIGJsdXIpXG4gICAgJChkb2N1bWVudCkub24oJ2JsdXInLCBcIiNwcm9qZWN0RmlsZXMgdGFibGUgdGJvZHkgdGRcIiwgZnVuY3Rpb24gZnJvbV9wcm9qZWN0KGUpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gJChlLnRhcmdldCkuY2xvc2VzdCgndHInKS5pbmRleCgpO1xuICAgICAgICBKU09OLnN0cmluZ2lmeShpbmZvX3Byb3h5KTsgLy8gdXBkYXRlIGNvbnRlbnQgb2YgcHJvamVjdEluZm8gb2JqZWN0IGZyb20gcHJveHkgYnkgY2FsbGluZyBhbGwgZ2V0dGVyc1xuICAgICAgICBBdGxhc01ha2VyV2lkZ2V0LnNlbmRTYXZlTWV0YWRhdGFNZXNzYWdlKHByb2plY3RJbmZvLmZpbGVzLmxpc3RbaW5kZXhdKTtcbiAgICB9KTtcbiAgICAvLyBibHVyIHdoZW4gW2VudGVyXSBpcyBjbGlja2VkLCB0byB0cmlnZ2VyIGRhdGEgc2VuZGluZ1xuICAgICQoZG9jdW1lbnQpLm9uKCdrZXlkb3duJywgXCIjcHJvamVjdEZpbGVzIHRhYmxlIHRib2R5IHRkXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYoZS53aGljaD09MTMgJiYgJChlLnRhcmdldCkuYXR0cignY29udGVudGVkaXRhYmxlJykpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICQoZS50YXJnZXQpLmJsdXIoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGJsdXIgd2hlbiA8c2VsZWN0PiBjaGFuZ2VzIHZhbHVlIHRvIHRyaWdnZXIgZGF0YSBzZW5kaW5nXG4gICAgJChcIiNwcm9qZWN0RmlsZXMgdGFibGUgdGJvZHlcIikub24oJ2NoYW5nZScsIFwic2VsZWN0XCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgJChlLnRhcmdldCkuYmx1cigpO1xuICAgIH0pO1xuXG4vLyBMaXN0ZW4gdG8gY2hhbmdlcyBpbiBzZWxlY3RlZCB0YWJsZSByb3dcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIGxpc3RlbiB0byBjaGFuZ2VzIGluIGZpbGUgc2VsZWN0aW9uIGJ5IGNsaWNraW5nIG9uIHRoZSBmaWxlIHRhYmxlXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrIHRvdWNoc3RhcnQnLCBcIiNwcm9qZWN0RmlsZXMgdGJvZHkgdHJcIixmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRhYmxlPSQodGhpcykuY2xvc2VzdChcInRhYmxlXCIpO1xuICAgICAgICB2YXIgY3VycmVudEluZGV4PSQodGFibGUpLmZpbmQoXCJ0ci5zZWxlY3RlZFwiKS5pbmRleCgpO1xuICAgICAgICB2YXIgaW5kZXg9JCh0aGlzKS5pbmRleCgpO1xuXG4gICAgICAgIGlmKGluZGV4Pj0wICYmIGN1cnJlbnRJbmRleCE9aW5kZXgpIHtcbiAgICAgICAgICAgICQodGFibGUpLmZpbmQoXCJ0clwiKS5yZW1vdmVDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgLy8gcmVtb3ZlIHRhYmxlIHdpdGggcHJldmlvdXMgYW5ub3RhdGlvbnNcbiAgICAgICAgICAgICQoXCJ0YWJsZSN2b2xBbm5vdGF0aW9ucyB0Ym9keVwiKS5odG1sKFwiXCIpO1xuICAgICAgICAgICAgLy8gbG9hZCBhbmQgYmluZCBuZXcgZmlsZVxuICAgICAgICAgICAgbG9hZFByb2plY3RGaWxlKGluZGV4KTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gbGlzdGVuIHRvIGNoYW5nZXMgaW4gZmlsZSBzZWxlY3Rpb24gYnkgcHJlc3NpbmcgdGhlIHVwL2Rvd24gYXJyb3dzXG4gICAgJChkb2N1bWVudCkub24oJ2tleWRvd24nLCBmdW5jdGlvbihlKXtcbiAgICAgICAgdmFyIHRhYmxlPSQoXCIjcHJvamVjdEZpbGVzIHRib2R5XCIpO1xuICAgICAgICB2YXIgaW5kZXg9JCh0YWJsZSkuZmluZChcInRyLnNlbGVjdGVkXCIpLmluZGV4KCk7XG4gICAgXG4gICAgICAgIGlmKGUua2V5Q29kZSE9MzggJiYgZS5rZXlDb2RlIT00MClcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBzd2l0Y2goZS5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIDM4OiAvLyB1cFxuICAgICAgICAgICAgICAgIGluZGV4PShpbmRleCtwcm9qZWN0SW5mby5maWxlcy5saXN0Lmxlbmd0aC0xKSVwcm9qZWN0SW5mby5maWxlcy5saXN0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNDA6IC8vIGRvd25cbiAgICAgICAgICAgICAgICBpbmRleD0oaW5kZXgrMSklcHJvamVjdEluZm8uZmlsZXMubGlzdC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgJCh0YWJsZSkuZmluZChcInRyXCIpLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICQodGFibGUpLmZpbmQoXCJ0cjplcShcIitpbmRleCtcIilcIikuYWRkQ2xhc3MoXCJzZWxlY3RlZFwiKTtcbiAgICBcbiAgICAgICAgLy8gcmVtb3ZlIHRhYmxlIHdpdGggcHJldmlvdXMgYW5ub3RhdGlvbnNcbiAgICAgICAgJChcInRhYmxlI3ZvbEFubm90YXRpb25zIHRib2R5XCIpLmh0bWwoXCJcIik7XG5cbiAgICAgICAgLy8gbG9hZCBhbmQgYmluZCBuZXcgZmlsZVxuICAgICAgICBsb2FkUHJvamVjdEZpbGUoaW5kZXgpO1xuICAgIH0pO1xuXG4gICAgLy8gbGlzdGVuIHRvIGNoYW5nZXMgaW4gc2VsZWN0ZWQgdm9sdW1lIGFubm90YXRpb25cbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2sgdG91Y2hzdGFydCcsIFwiI3ZvbEFubm90YXRpb25zIHRib2R5IHRyXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRhYmxlPSQodGhpcykuY2xvc2VzdChcInRib2R5XCIpO1xuICAgICAgICB2YXIgY3VycmVudEluZGV4PSQodGFibGUpLmZpbmQoXCJ0ci5zZWxlY3RlZFwiKS5pbmRleCgpO1xuICAgICAgICB2YXIgaW5kZXg9JCh0aGlzKS5pbmRleCgpO1xuXG4gICAgICAgIGlmKGluZGV4Pj0wICYmIGN1cnJlbnRJbmRleCE9aW5kZXgpIHtcbiAgICAgICAgICAgICQodGFibGUpLmZpbmQoXCJ0clwiKS5yZW1vdmVDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgIFxuICAgICAgICAgICAgdmFyIGlhcnIsZm91bmQ9ZmFsc2U7XG4gICAgICAgICAgICBmb3IoaWFycj0wO2lhcnI8QnJhaW5Cb3guaW5mby5tcmkuYXRsYXMubGVuZ3RoO2lhcnIrKykge1xuICAgICAgICAgICAgICAgIGlmKEJyYWluQm94LmluZm8ubXJpLmF0bGFzW2lhcnJdLm5hbWU9PWFubm90YXRpb25zLnZvbHVtZVtpbmRleF0ubmFtZVxuICAgICAgICAgICAgICAgICAgICAmJiBCcmFpbkJveC5pbmZvLm1yaS5hdGxhc1tpYXJyXS5wcm9qZWN0PT1wcm9qZWN0SW5mby5zaG9ydG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZm91bmQ9dHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoZm91bmQpXG4gICAgICAgICAgICAgICAgQXRsYXNNYWtlcldpZGdldC5jb25maWd1cmVBdGxhc01ha2VyKEJyYWluQm94LmluZm8saWFycik7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFUlJPUjogQSBxdWl0ZSB1bmV4cGVjdGVkIG9uZSB0b28uLi5cIik7XG4gICAgICAgIH1cbiAgICB9KTtcblxuLy8gRnVuY3Rpb25zXG4vLy0tLS0tLS0tLS1cbmZ1bmN0aW9uIHF1ZXJ5RmlsZXMoKSB7XG4gICAgJC5nZXRKU09OKFwiL3Byb2plY3QvanNvbi9cIitwcm9qZWN0SW5mby5zaG9ydG5hbWUrXCIvZmlsZXNcIiwge1xuICAgICAgICBzdGFydDogcHJvamVjdEluZm8uZmlsZXMubGlzdC5sZW5ndGgsXG4gICAgICAgIGxlbmd0aDogbnVtRmlsZXNRdWVyeVxuICAgIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24obGlzdCkge1xuICAgICAgICBpZihsaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgYXBwZW5kRmlsZXNUb1Byb2plY3QobGlzdCk7XG4gICAgICAgICAgICBxdWVyeUZpbGVzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFsbCBmaWxlcyBkb3dubG9hZGVkLiBMZW5ndGg6XCIscHJvamVjdEluZm8uZmlsZXMubGlzdC5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgfSlcbn1cbmZ1bmN0aW9uIGFwcGVuZEZpbGVzVG9Qcm9qZWN0KGxpc3QpIHtcbiAgICB2YXIgaTAsIGksIGo7XG4gICAgXG4gICAgaTAgPSBwcm9qZWN0SW5mby5maWxlcy5saXN0Lmxlbmd0aDtcbiAgICBwcm9qZWN0SW5mby5maWxlcy5saXN0LnB1c2guYXBwbHkocHJvamVjdEluZm8uZmlsZXMubGlzdCwgbGlzdCk7XG4gICAgXG4gICAgLy8gbWFrZSBzdXJlIHRoYXQgYWxsIG1yaSBmaWxlcyBoYXZlIGEgdGV4dCBhbm5vdGF0aW9ucyBvYmplY3QgZm9yIHRoZSBwcm9qZWN0XG4gICAgZm9yKGk9MDtpPGxpc3QubGVuZ3RoO2krKykge1xuICAgICAgICBmaWxlID0gcHJvamVjdEluZm8uZmlsZXMubGlzdFtpMCtpXTtcbiAgICAgICAgaWYgKCEoZmlsZS5tcmkpKSB7XG4gICAgICAgICAgICBmaWxlLm1yaSA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGlmICghKGZpbGUubXJpLmFubm90YXRpb25zKSkge1xuICAgICAgICAgICAgZmlsZS5tcmkuYW5ub3RhdGlvbnMgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIShmaWxlLm1yaS5hbm5vdGF0aW9uc1twcm9qU2hvcnRuYW1lXSkpIHtcbiAgICAgICAgICAgIGZpbGUubXJpLmFubm90YXRpb25zW3Byb2pTaG9ydG5hbWVdID0ge307XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gaW5pdGlhbGlzZSB0aGUgcmVsZXZhbnQgYW5ub3RhdGlvbiBlbnRyaWVzIGluIGVhY2ggbXJpIGZpbGUgaWYgcmVxdWlyZWRcbiAgICBmb3IoaT0wO2k8bGlzdC5sZW5ndGg7aSsrKSB7XG4gICAgICAgIGZpbGUgPSBwcm9qZWN0SW5mby5maWxlcy5saXN0W2kwK2ldO1xuICAgICAgICBmb3Ioaj0wO2o8YW5ub3RhdGlvbnMudGV4dC5sZW5ndGg7aisrKSB7XG4gICAgICAgICAgICBhbm5OYW1lID0gYW5ub3RhdGlvbnMudGV4dFtqXS5uYW1lO1xuICAgICAgICAgICAgaWYoIWZpbGUubXJpLmFubm90YXRpb25zW3Byb2pTaG9ydG5hbWVdW2Fubk5hbWVdKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGU9bmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICBmaWxlLm1yaS5hbm5vdGF0aW9uc1twcm9qU2hvcnRuYW1lXVthbm5OYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZDogZGF0ZS50b0pTT04oKSxcbiAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWQ6IGRhdGUudG9KU09OKCksXG4gICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQnk6IEF0bGFzTWFrZXJXaWRnZXQuVXNlci51c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGZvcih2YXIgaT0wO2k8bGlzdC5sZW5ndGg7aSsrKSB7XG4gICAgICAgIEJyYWluQm94LmFwcGVuZEFubm90YXRpb25UYWJsZVJvdyhpMCtpLGFQYXJhbSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBmdW5jIGxvYWRQcm9qZWN0RmlsZVxuICogQGRlc2MgbG9hZCBhIG5ldyBtcmkgZnJvbSB0aGUgcHJvamVjdCBsaXN0XG4gKi9cbmZ1bmN0aW9uIGxvYWRQcm9qZWN0RmlsZShpbmRleCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdmFyIHVybD1wcm9qZWN0SW5mby5maWxlcy5saXN0W2luZGV4XS5zb3VyY2U7XG4gICAgICAgIHZhciBwYXJhbXM9e3VybDp1cmwsdmlldzpcImNvclwiLHNsaWNlOjE4MCxmdWxsc2NyZWVuOmZhbHNlfTtcbiAgICAgICAgJChcIiNsb2FkaW5nSW5kaWNhdG9yIHBcIikudGV4dChcIkxvYWRpbmcuLi5cIik7XG4gICAgICAgICQoXCIjbG9hZGluZ0luZGljYXRvclwiKS5zaG93KCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEB0b2RvIFRoZSBtcmkgZW50cnkgbWF5IGNvcnJlc3BvbmQgdG8gYSBmaWxlIHRoYXQgaGFzIG5vdCBiZWVuIGRvd25sb2FkZWQgeWV0IVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGluZm8gPSBwcm9qZWN0SW5mby5maWxlcy5saXN0W2luZGV4XTtcblxuICAgICAgICBpZigkLmlzRW1wdHlPYmplY3QoaW5mbykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgbXJpIGNvbnRhaW5zIHRoZSByZXF1aXJlZCBhbm5vdGF0aW9uc1xuICAgICAgICAgICAgdmFyIGlyb3c7IC8vIGluZGV4IG9mIHRoZSB0YWJsZSByb3dcbiAgICAgICAgICAgIHZhciBpYXJyOyAvLyBpbmRleCBvZiB0aGUgb2JqZWN0IGluIHRoZSBkYXRhIGFycmF5XG4gICAgICAgICAgICBmb3IoaXJvdz0wO2lyb3c8YW5ub3RhdGlvbnMudm9sdW1lLmxlbmd0aDtpcm93KyspIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmKCFpbmZvLm1yaS5hdGxhcylcbiAgICAgICAgICAgICAgICAgICAgaW5mby5tcmkuYXRsYXMgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IoaWFycj0wO2lhcnI8aW5mby5tcmkuYXRsYXMubGVuZ3RoO2lhcnIrKykge1xuICAgICAgICAgICAgICAgICAgICBpZihhbm5vdGF0aW9ucy52b2x1bWVbaXJvd10ubmFtZSA9PSBpbmZvLm1yaS5hdGxhc1tpYXJyXS5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICYmIHByb2plY3RJbmZvLnNob3J0bmFtZSA9PSBpbmZvLm1yaS5hdGxhc1tpYXJyXS5wcm9qZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZD10cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gaWYgaXQgZG9lc24ndCwgY3JlYXRlIHRoZW1cbiAgICAgICAgICAgICAgICBpZihmb3VuZCA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYW5ub3RhdGlvblxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZT1uZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgZGF0YSB0byBhbm5vdGF0aW9ucyBhcnJheVxuICAgICAgICAgICAgICAgICAgICB2YXIgYXRsYXMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBhbm5vdGF0aW9ucy52b2x1bWVbaXJvd10ubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3Q6IHByb2plY3RJbmZvLnNob3J0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWQ6IGRhdGUudG9KU09OKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZDogZGF0ZS50b0pTT04oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkQnk6IEF0bGFzTWFrZXJXaWRnZXQuVXNlci51c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKStcIi5uaWkuZ3pcIixcdC8vIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGZpbGVuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IGFubm90YXRpb25zLnZvbHVtZVtpcm93XS52YWx1ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBvd25lcjogQXRsYXNNYWtlcldpZGdldC5Vc2VyLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ2b2x1bWVcIlxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHByb2plY3RJbmZvLmZpbGVzLmxpc3RbaW5kZXhdLm1yaS5hdGxhcy5wdXNoKGF0bGFzKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9ucy52b2x1bWVbaXJvd10uYW5ub3RhdGlvbkl0ZW1JbmRleD1pYXJyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFyYW1zLmluZm89cHJvamVjdEluZm8uZmlsZXMubGlzdFtpbmRleF07XG5cbiAgICAgICAgICAgIGlmKGFubm90YXRpb25zLnZvbHVtZVswXSkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5hbm5vdGF0aW9uSXRlbUluZGV4ID0gYW5ub3RhdGlvbnMudm9sdW1lWzBdLmFubm90YXRpb25JdGVtSW5kZXg7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5hbm5vdGF0aW9uSXRlbUluZGV4ID0gLTE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIEJyYWluQm94LmNvbmZpZ3VyZUJyYWluQm94KHBhcmFtcylcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIGZyb21fcHJvamVjdCgpe1xuXG4gICAgICAgICAgICAgICAgLy8gYmluZCB2b2x1bWUgYW5ub3RhdGlvbnMgdG8gdGFibGUjdm9sQW5ub3RhdGlvbnNcbiAgICAgICAgICAgICAgICB2YXIgYW5udm9sX3Byb3h5PXt9O1xuICAgICAgICAgICAgICAgIHZhciBhUGFyYW0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlOiAkKFwidGFibGUjdm9sQW5ub3RhdGlvbnNcIiksXG4gICAgICAgICAgICAgICAgICAgIGluZm9fcHJveHk6IGFubnZvbF9wcm94eSxcbiAgICAgICAgICAgICAgICAgICAgaW5mbzogQnJhaW5Cb3guaW5mbyxcbiAgICAgICAgICAgICAgICAgICAgdHJUZW1wbGF0ZTogJC5tYXAoW1xuICAgICAgICAgICAgICAgICAgICAgICAgXCI8dHI+XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiA8dGQ+PC90ZD5cIiwgICAgICAgICAgIC8vIHZvbHVtZSBuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiA8dGQ+PC90ZD5cIixcdCAgICAgICAgLy8gdm9sdW1lIGxhYmVsIHNldFxuICAgICAgICAgICAgICAgICAgICAgICAgXCI8L3RyPlwiXSxmdW5jdGlvbihvKXtyZXR1cm4gb30pLmpvaW4oKSxcbiAgICAgICAgICAgICAgICAgICAgb2JqVGVtcGxhdGU6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcdHR5cGVPZkJpbmRpbmc6MSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOlwibXJpLmF0bGFzLiMubmFtZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1x0dHlwZU9mQmluZGluZzoxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6XCJtcmkuYXRsYXMuIy5sYWJlbHNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIGFkZCBhbmQgYmluZCBuZXcgdGFibGUgcm93XG4gICAgICAgICAgICAgICAgZm9yKGlyb3c9MDtpcm93PGFubm90YXRpb25zLnZvbHVtZS5sZW5ndGg7aXJvdysrKSB7XG4gICAgICAgICAgICAgICAgICAgIEJyYWluQm94LmFwcGVuZEFubm90YXRpb25UYWJsZVJvdzIoaXJvdyxhbm5vdGF0aW9ucy52b2x1bWVbaXJvd10uYW5ub3RhdGlvbkl0ZW1JbmRleCxhUGFyYW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgaW4gc2VydmVyXG4gICAgICAgICAgICAgICAgc2F2ZUFubm90YXRpb25zKGFQYXJhbSk7XG5cbiAgICAgICAgICAgICAgICAvLyBzZWxlY3QgdGhlIGZpcnN0IGFubm90YXRpb24gYnkgZGVmYXVsdFxuICAgICAgICAgICAgICAgIC8vIChzaG91bGQgYmUgcmVhZCBmcm9tIHByb2plY3Qgc2V0dGluZ3MpXG4gICAgICAgICAgICAgICAgJChcIiNhbm5vdGF0aW9ucyB0Ym9keSB0cjplcSgwKVwiKS5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xuXG4gICAgICAgICAgICAgICAgQXRsYXNNYWtlcldpZGdldC5Vc2VyLnByb2plY3RQYWdlID0gcHJvamVjdEluZm8uc2hvcnRuYW1lO1xuICAgICAgICAgICAgICAgIEF0bGFzTWFrZXJXaWRnZXQuc2VuZFVzZXJEYXRhTWVzc2FnZShKU09OLnN0cmluZ2lmeSh7cHJvamVjdFBhZ2U6cHJvamVjdEluZm8uc2hvcnRuYW1lfSkpO1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgbXNnPUF0bGFzTWFrZXJXaWRnZXQuY29udGFpbmVyLmZpbmQoXCIjdGV4dC1sYXllclwiKTtcbiAgICAgICAgICAgIG1zZy5odG1sKFwiPHRleHQgeD0nNScgeT0nMTUnIGZpbGw9J3doaXRlJz5FUlJPUjogRmlsZSBpcyB1bnJlYWRhYmxlPC90ZXh0PlwiKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRVJST1I6IENhbm5vdCByZWFkIGRhdGEuIFRoZSBmaWxlIGlzIG1heWJlIGNvcnJ1cHQ/XCIpO1xuXG4gICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZnVuY3Rpb24gc2F2ZUFubm90YXRpb25zKHBhcmFtKSB7XG4gICAgSlNPTi5zdHJpbmdpZnkocGFyYW0uaW5mb19wcm94eSk7IC8vIHVwZGF0ZSBCcmFpbkJveC5pbmZvIGZyb20gaW5mb19wcm94eVxuICAgIEF0bGFzTWFrZXJXaWRnZXQuc2VuZFNhdmVNZXRhZGF0YU1lc3NhZ2UoQnJhaW5Cb3guaW5mbyk7XG4gICAgaGFzaE9sZD1CcmFpbkJveC5oYXNoKEpTT04uc3RyaW5naWZ5KEJyYWluQm94LmluZm8pKTtcbn1cbi8qKlxuICogQGZ1bmMgcmVzaXplQnV0dG9uXG4gKiBAZGVzYyBSZXNpemUgbGVmdCB0b29sIGJhclxuICovXG5mdW5jdGlvbiByZXNpemVCdXR0b24ocCkge1xuICAgIGlmKCQoXCIjcmVzaXplQnV0dG9uXCIpLmRhdGEoXCJmbGFnXCIpPT0wKSB7XG4gICAgICAgICQoXCIjcmVzaXplQnV0dG9uXCIpLmRhdGEoe2ZsYWc6MSx4MDpwLngseTA6cC55fSk7XG4gICAgfSBlbHNlIGlmKCQoXCIjcmVzaXplQnV0dG9uXCIpLmRhdGEoXCJmbGFnXCIpPT0xKSB7XG4gICAgICAgIHZhciBkPSQoXCIjcmVzaXplQnV0dG9uXCIpLmRhdGEoXCJ4MFwiKS1wLng7XG4gICAgICAgICQoXCIjbGVmdFwiKS5jc3MoeydmbGV4LWJhc2lzJzokKFwiI2xlZnRcIikud2lkdGgoKS1kfSk7XG4gICAgICAgICQoXCIjcmVzaXplQnV0dG9uXCIpLmRhdGEoe3gwOnAueCx5MDpwLnl9KTtcbiAgICAgICAgQXRsYXNNYWtlcldpZGdldC5yZXNpemVXaW5kb3coKTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///5\n')}});