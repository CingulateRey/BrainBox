!function(I){var g={};function C(n){if(g[n])return g[n].exports;var t=g[n]={i:n,l:!1,exports:{}};return I[n].call(t.exports,t,t.exports,C),t.l=!0,t.exports}C.m=I,C.c=g,C.d=function(I,g,n){C.o(I,g)||Object.defineProperty(I,g,{enumerable:!0,get:n})},C.r=function(I){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})},C.t=function(I,g){if(1&g&&(I=C(I)),8&g)return I;if(4&g&&"object"==typeof I&&I&&I.__esModule)return I;var n=Object.create(null);if(C.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:I}),2&g&&"string"!=typeof I)for(var t in I)C.d(n,t,function(g){return I[g]}.bind(null,t));return n},C.n=function(I){var g=I&&I.__esModule?function(){return I.default}:function(){return I};return C.d(g,"a",g),g},C.o=function(I,g){return Object.prototype.hasOwnProperty.call(I,g)},C.p="",C(C.s=6)}([function(module,__webpack_exports__,__webpack_require__){"use strict";eval("/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return freeform; });\n/**\n * @function freeform\n * @desc Basic handling of text annotations\n */\nfunction freeform(annotation, path, username) {\n    let td; // the object that will go into the table\n    let obj; // the object that will go into the database\n\n    // configure table row\n    td = \"<td contentEditable=true class='noEmpty'></td>\";\n\n    // configure database object\n    obj = {\n        typeOfBinding:2,\n        path: path,\n        format: function(e, d) {\n            if(typeof d.data === 'undefined') {\n                e.get(0).innerHTML = \"\";\n            } else {\n                e.get(0).innerHTML = '<span>'+d.data+'</span>';\n            }\n        },\n        parse: function(e, d) {\n            const obj = d;\n            obj.modified = (new Date()).toJSON();\n            obj.modifiedBy = username;\n            obj.data = e.get(0).textContent;\n            return obj;\n        }\n    };\n\n    return {td, obj};\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi92aWV3L2JyYWluYm94L3NyYy90b29scy9mcmVlZm9ybS5qcz81MzgzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDZTtBQUNmLFdBQVc7QUFDWCxZQUFZOztBQUVaO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFlBQVk7QUFDWiIsImZpbGUiOiIwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZnVuY3Rpb24gZnJlZWZvcm1cbiAqIEBkZXNjIEJhc2ljIGhhbmRsaW5nIG9mIHRleHQgYW5ub3RhdGlvbnNcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZnJlZWZvcm0oYW5ub3RhdGlvbiwgcGF0aCwgdXNlcm5hbWUpIHtcbiAgICBsZXQgdGQ7IC8vIHRoZSBvYmplY3QgdGhhdCB3aWxsIGdvIGludG8gdGhlIHRhYmxlXG4gICAgbGV0IG9iajsgLy8gdGhlIG9iamVjdCB0aGF0IHdpbGwgZ28gaW50byB0aGUgZGF0YWJhc2VcblxuICAgIC8vIGNvbmZpZ3VyZSB0YWJsZSByb3dcbiAgICB0ZCA9IFwiPHRkIGNvbnRlbnRFZGl0YWJsZT10cnVlIGNsYXNzPSdub0VtcHR5Jz48L3RkPlwiO1xuXG4gICAgLy8gY29uZmlndXJlIGRhdGFiYXNlIG9iamVjdFxuICAgIG9iaiA9IHtcbiAgICAgICAgdHlwZU9mQmluZGluZzoyLFxuICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uKGUsIGQpIHtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBkLmRhdGEgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgZS5nZXQoMCkuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZS5nZXQoMCkuaW5uZXJIVE1MID0gJzxzcGFuPicrZC5kYXRhKyc8L3NwYW4+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uKGUsIGQpIHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IGQ7XG4gICAgICAgICAgICBvYmoubW9kaWZpZWQgPSAobmV3IERhdGUoKSkudG9KU09OKCk7XG4gICAgICAgICAgICBvYmoubW9kaWZpZWRCeSA9IHVzZXJuYW1lO1xuICAgICAgICAgICAgb2JqLmRhdGEgPSBlLmdldCgwKS50ZXh0Q29udGVudDtcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIHt0ZCwgb2JqfTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///0\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval("/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return hidden; });\n/**\n * @function hidden\n * @desc Handles hidden text annotations\n */\nfunction hidden(annotation, path, username) {\n    let td; // the object that will go into the table\n    let obj; // the object that will go into the database\n\n    // configure table row\n    td = \"<td contentEditable=true class='hidden'></td>\";\n\n    // configure database object\n    obj = {\n        typeOfBinding:2,\n        path: path,\n        format: function(e, d) {\n            if(typeof d.data === 'undefined') {\n                e.get(0).innerHTML = \"\";\n            } else {\n                e.get(0).innerHTML = '<span>'+d.data+'</span>';\n            }\n        },\n        parse: function(e, d) {\n            const obj = d;\n            obj.modified = (new Date()).toJSON();\n            obj.modifiedBy = username;\n            obj.data = e.get(0).textContent;\n            return obj;\n        }\n    };\n\n    return {td, obj};\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi92aWV3L2JyYWluYm94L3NyYy90b29scy9oaWRkZW4uanM/NzVmOCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ2U7QUFDZixXQUFXO0FBQ1gsWUFBWTs7QUFFWjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxZQUFZO0FBQ1oiLCJmaWxlIjoiMS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZ1bmN0aW9uIGhpZGRlblxuICogQGRlc2MgSGFuZGxlcyBoaWRkZW4gdGV4dCBhbm5vdGF0aW9uc1xuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBoaWRkZW4oYW5ub3RhdGlvbiwgcGF0aCwgdXNlcm5hbWUpIHtcbiAgICBsZXQgdGQ7IC8vIHRoZSBvYmplY3QgdGhhdCB3aWxsIGdvIGludG8gdGhlIHRhYmxlXG4gICAgbGV0IG9iajsgLy8gdGhlIG9iamVjdCB0aGF0IHdpbGwgZ28gaW50byB0aGUgZGF0YWJhc2VcblxuICAgIC8vIGNvbmZpZ3VyZSB0YWJsZSByb3dcbiAgICB0ZCA9IFwiPHRkIGNvbnRlbnRFZGl0YWJsZT10cnVlIGNsYXNzPSdoaWRkZW4nPjwvdGQ+XCI7XG5cbiAgICAvLyBjb25maWd1cmUgZGF0YWJhc2Ugb2JqZWN0XG4gICAgb2JqID0ge1xuICAgICAgICB0eXBlT2ZCaW5kaW5nOjIsXG4gICAgICAgIHBhdGg6IHBhdGgsXG4gICAgICAgIGZvcm1hdDogZnVuY3Rpb24oZSwgZCkge1xuICAgICAgICAgICAgaWYodHlwZW9mIGQuZGF0YSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBlLmdldCgwKS5pbm5lckhUTUwgPSBcIlwiO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlLmdldCgwKS5pbm5lckhUTUwgPSAnPHNwYW4+JytkLmRhdGErJzwvc3Bhbj4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwYXJzZTogZnVuY3Rpb24oZSwgZCkge1xuICAgICAgICAgICAgY29uc3Qgb2JqID0gZDtcbiAgICAgICAgICAgIG9iai5tb2RpZmllZCA9IChuZXcgRGF0ZSgpKS50b0pTT04oKTtcbiAgICAgICAgICAgIG9iai5tb2RpZmllZEJ5ID0gdXNlcm5hbWU7XG4gICAgICAgICAgICBvYmouZGF0YSA9IGUuZ2V0KDApLnRleHRDb250ZW50O1xuICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4ge3RkLCBvYmp9O1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return multiple; });\n/**\n * @function multiple\n * @desc Handles annotations restricted to a reduced number of options\n */\n\nfunction multiple(annotation, path, username) {\n    let td = []; // the object that will go into the table\n    let obj; // the object that will go into the database\n    const values = annotation.values.split(/[, ]+/);\n\n    // configure table row\n    td.push("<td><select value=0><option value=\'\' disabled selected hidden>Empty</option>");\n    for (var o in values) {\n        td.push("<option value=\\"" + values[o] + "\\"" + ">" + values[o] + "</option>");\n    }\n    td.push("</select></td>");\n    td = td.join("\\n");\n\n    // configure database object\n    obj = {\n        typeOfBinding:2,\n        path: path,\n        format: function(e, d) {\n            var obj = d;\n            if (typeof obj.data !== \'undefined\') {\n                /**\n                 * @todo Replace color assignment by the addition of a class\n                 */\n                e.get(0).querySelectorAll("select")[0].style.color = "#fff"; \n                e.get(0).querySelectorAll("select")[0].value = obj.data; \n            } else {\n                e.get(0).querySelectorAll("select")[0].value = ""; \n            }\n        },\n        parse: function(e, d) {\n            if (e.get(0).querySelectorAll("select")[0].value) {\n                e.get(0).querySelectorAll("select")[0].style.color = "#fff";\n            }\n            const obj = d;\n            obj.modified = (new Date()).toJSON();\n            obj.modifiedBy = username;\n            obj.data = e.get(0).querySelectorAll("select")[0].value;\n            return obj;\n        }\n    };\n\n    return {td, obj};\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi92aWV3L2JyYWluYm94L3NyYy90b29scy9tdWx0aXBsZS5qcz9hYWUwIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7O0FBRWU7QUFDZixnQkFBZ0I7QUFDaEIsWUFBWTtBQUNaOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEU7QUFDQSx3RTtBQUNBLGFBQWE7QUFDYixrRTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsWUFBWTtBQUNaIiwiZmlsZSI6IjIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmdW5jdGlvbiBtdWx0aXBsZVxuICogQGRlc2MgSGFuZGxlcyBhbm5vdGF0aW9ucyByZXN0cmljdGVkIHRvIGEgcmVkdWNlZCBudW1iZXIgb2Ygb3B0aW9uc1xuICovXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG11bHRpcGxlKGFubm90YXRpb24sIHBhdGgsIHVzZXJuYW1lKSB7XG4gICAgbGV0IHRkID0gW107IC8vIHRoZSBvYmplY3QgdGhhdCB3aWxsIGdvIGludG8gdGhlIHRhYmxlXG4gICAgbGV0IG9iajsgLy8gdGhlIG9iamVjdCB0aGF0IHdpbGwgZ28gaW50byB0aGUgZGF0YWJhc2VcbiAgICBjb25zdCB2YWx1ZXMgPSBhbm5vdGF0aW9uLnZhbHVlcy5zcGxpdCgvWywgXSsvKTtcblxuICAgIC8vIGNvbmZpZ3VyZSB0YWJsZSByb3dcbiAgICB0ZC5wdXNoKFwiPHRkPjxzZWxlY3QgdmFsdWU9MD48b3B0aW9uIHZhbHVlPScnIGRpc2FibGVkIHNlbGVjdGVkIGhpZGRlbj5FbXB0eTwvb3B0aW9uPlwiKTtcbiAgICBmb3IgKHZhciBvIGluIHZhbHVlcykge1xuICAgICAgICB0ZC5wdXNoKFwiPG9wdGlvbiB2YWx1ZT1cXFwiXCIgKyB2YWx1ZXNbb10gKyBcIlxcXCJcIiArIFwiPlwiICsgdmFsdWVzW29dICsgXCI8L29wdGlvbj5cIik7XG4gICAgfVxuICAgIHRkLnB1c2goXCI8L3NlbGVjdD48L3RkPlwiKTtcbiAgICB0ZCA9IHRkLmpvaW4oXCJcXG5cIik7XG5cbiAgICAvLyBjb25maWd1cmUgZGF0YWJhc2Ugb2JqZWN0XG4gICAgb2JqID0ge1xuICAgICAgICB0eXBlT2ZCaW5kaW5nOjIsXG4gICAgICAgIHBhdGg6IHBhdGgsXG4gICAgICAgIGZvcm1hdDogZnVuY3Rpb24oZSwgZCkge1xuICAgICAgICAgICAgdmFyIG9iaiA9IGQ7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9iai5kYXRhICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEB0b2RvIFJlcGxhY2UgY29sb3IgYXNzaWdubWVudCBieSB0aGUgYWRkaXRpb24gb2YgYSBjbGFzc1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGUuZ2V0KDApLnF1ZXJ5U2VsZWN0b3JBbGwoXCJzZWxlY3RcIilbMF0uc3R5bGUuY29sb3IgPSBcIiNmZmZcIjsgXG4gICAgICAgICAgICAgICAgZS5nZXQoMCkucXVlcnlTZWxlY3RvckFsbChcInNlbGVjdFwiKVswXS52YWx1ZSA9IG9iai5kYXRhOyBcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZS5nZXQoMCkucXVlcnlTZWxlY3RvckFsbChcInNlbGVjdFwiKVswXS52YWx1ZSA9IFwiXCI7IFxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwYXJzZTogZnVuY3Rpb24oZSwgZCkge1xuICAgICAgICAgICAgaWYgKGUuZ2V0KDApLnF1ZXJ5U2VsZWN0b3JBbGwoXCJzZWxlY3RcIilbMF0udmFsdWUpIHtcbiAgICAgICAgICAgICAgICBlLmdldCgwKS5xdWVyeVNlbGVjdG9yQWxsKFwic2VsZWN0XCIpWzBdLnN0eWxlLmNvbG9yID0gXCIjZmZmXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBvYmogPSBkO1xuICAgICAgICAgICAgb2JqLm1vZGlmaWVkID0gKG5ldyBEYXRlKCkpLnRvSlNPTigpO1xuICAgICAgICAgICAgb2JqLm1vZGlmaWVkQnkgPSB1c2VybmFtZTtcbiAgICAgICAgICAgIG9iai5kYXRhID0gZS5nZXQoMCkucXVlcnlTZWxlY3RvckFsbChcInNlbGVjdFwiKVswXS52YWx1ZTtcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIHt0ZCwgb2JqfTtcbn1cblxuXG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///2\n')},,,,function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _tools_freeform_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(0);\n/* harmony import */ var _tools_hidden_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(1);\n/* harmony import */ var _tools_multiple_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(2);\n\n\n\n\nconst projShortname = projectInfo.shortname;\nconst numFilesQuery = 20;\nconst annotations = {\n    text: [],   // collect text annotations\n    volume: []  // collect volume annotations\n};\nlet k, h, str, found, annType, annName, file;\nlet trTemplate;\nlet objTemplate;\nlet aParam;\nlet hashOld;\n\n\n// Prevent zoom on double tap\n$(\'body\').on(\'touchstart\', function preventZoom(e) {\n    var t2 = e.timeStamp\n      , t1 = $(this).data(\'lastTouch\') || t2\n      , dt = t2 - t1\n      , fingers = e.originalEvent.touches.length;\n    $(this).data(\'lastTouch\', t2);\n    if (!dt || dt > 500 || fingers > 1) return; // not double-tap\n    e.preventDefault(); // double tap - prevent the zoom\n    // also synthesize click events we just swallowed up\n    $(this).trigger(\'click\').trigger(\'click\');\n});\n\n// collect the project\'s text annotations\nfor(k=0;k<projectInfo.annotations.list.length;k++) {\n    if (projectInfo.annotations.list[k].type === "text" |\n        projectInfo.annotations.list[k].type === "hidden text" |\n        projectInfo.annotations.list[k].type === "multiple choices") {\n        $("#projectFiles thead tr").append("<th>" + projectInfo.annotations.list[k].name + "</th>");\n        annotations.text.push(projectInfo.annotations.list[k]);\n    }\n}\n// collect the project\'s volume annotations\nfor(k=0;k<projectInfo.annotations.list.length;k++) {\n    if (projectInfo.annotations.list[k].type === "volume") {\n        annotations.volume.push(projectInfo.annotations.list[k]);\n    }\n}\n\n$("#projectName").text(projectInfo.name);\n\n$("#resizeButton").data({flag:-1,x0:0,y0:0});\n$("#resizeButton").on(\'mousedown touchstart\',function(e){$(this).data({flag:0,x0:e.pageX,y0:e.pageY})});\n$("body").on(\'mousemove\',function(e){resizeButton({x:e.pageX,y:e.pageY})});\n$("body").on(\'touchmove\',function(e){resizeButton({x:e.originalEvent.changedTouches[0].pageX,y:e.originalEvent.changedTouches[0].pageY})});\n$("body").on(\'mouseup touchend\',function(e){$("#resizeButton").data({flag:-1})});\n\n$("#addProject").click(function(){location="/project/new"});\n$("#settings").click(function(){\n    var pathname=location.pathname;\n    if(pathname.slice(-1)=="/")\n        location=pathname+"settings";\n    else\n        location=pathname+"/settings";\n});\n\n\n// Init BrainBox\n//---------------\n    BrainBox.initBrainBox()\n    .then(function from_project(){\n        return BrainBox.loadLabelsets();\n    })\n    .then(function () {\n        // Bind the project\'s files to the table within #projectFiles\n        //------------------------------------------------------------\n        trTemplate = [\'<tr>\'];\n        objTemplate = [];\n\n        // configure the binding template for table row and object.\n        // the 1st two columns are fixed: name and source\n        trTemplate.push(["<td contentEditable=true class=\'noEmpty\'></td>"]);\n        objTemplate.push({ typeOfBinding: 2, path: "files.list.#.name"});\n\n        trTemplate.push(["<td><a></a></td>"]);\n        objTemplate.push({\n            typeOfBinding:1,\n            path:"files.list.#.source",\n            format:function(e, d){\n                $(e).find("a").prop("href", location.origin+"/mri?url=" + d);\n                $(e).find("a").html(d.split("/").pop());\n            }\n        });\n\n        // the following columns are completed from the project\'s \'annotations\' definitions:\n        // determine their type of display (either select or freeform at the moment) based data type\n        let g;\n        for(g=0; g<annotations.text.length; g++) {\n            annType = annotations.text[g].type;\n            annName = annotations.text[g].name;\n\n            if(annType === "multiple choices") {\n                // array of values\n                let {td, obj} = Object(_tools_multiple_js__WEBPACK_IMPORTED_MODULE_2__[/* default */ "a"])(\n                    annotations.text[g],\n                    "files.list.#.mri.annotations." + projShortname + "." + annName,\n                    AtlasMakerWidget.User.username\n                );\n                trTemplate.push(td);\n                objTemplate.push(obj);\n            } else if(annType === "text") {\n                // freeform text\n                let {td, obj} = Object(_tools_freeform_js__WEBPACK_IMPORTED_MODULE_0__[/* default */ "a"])(\n                    annotations.text[g],\n                    "files.list.#.mri.annotations." + projShortname + "." + annName,\n                    AtlasMakerWidget.User.username\n                );\n                trTemplate.push(td);\n                objTemplate.push(obj);\n            } else if(annType === "hidden text") {\n                // freeform text\n                let {td, obj} = Object(_tools_hidden_js__WEBPACK_IMPORTED_MODULE_1__[/* default */ "a"])(\n                    annotations.text[g],\n                    "files.list.#.mri.annotations." + projShortname + "." + annName,\n                    AtlasMakerWidget.User.username\n                );\n                trTemplate.push(td);\n                objTemplate.push(obj);\n            }\n            /**\n             * @todo This is the place where \'position\' or \'length\' annotations should be added\n             */\n        }\n        trTemplate.push("</tr>");\n        aParam = {\n            table: $("#projectFiles table"),\n            info_proxy: info_proxy,\n            info: projectInfo,\n            trTemplate: trTemplate.join("\\n"),\n            objTemplate: objTemplate\n        };\n    })\n    .then(function() {\n\n        // Append the project files progressively. Start with the 1st #numFilesQuery files, load and\n        // display the 1st file, configure the tools position, and keep querying for the\n        // rest of the files\n        return $.getJSON("/project/json/"+projectInfo.shortname+"/files", {\n            start: 0,\n            length: numFilesQuery\n        })\n    })\n    .then(function(list) {\n        appendFilesToProject(list);\n        \n        // mark first row as selected\n        $("#projectFiles tbody tr:eq(0)").addClass("selected");\n    })\n    .then(function from_project(){return loadProjectFile(0)})\n    .then(function from_project(){\n        $("#tools-side").detach().appendTo(\'#tools\');\n        // connect colours close button\n        $(document).on(\'click touchstart\', "#labels-close", function(){$("#labelset").hide()});\n    })\n    .then(function() {\n        queryFiles();\n    })\n    .catch( err => {\n        $("#msgLog").html("ERROR: Can\'t load data. " + err);\n        console.error(err);\n    });\n\n// Listen to changes that trigger a metadata save\n//------------------------------------------------\n    // send data when focus is lost (on blur)\n    $(document).on(\'blur\', "#projectFiles table tbody td", function from_project(e) {\n        var index = $(e.target).closest(\'tr\').index();\n        JSON.stringify(info_proxy); // update content of projectInfo object from proxy by calling all getters\n        AtlasMakerWidget.sendSaveMetadataMessage(projectInfo.files.list[index]);\n    });\n    // blur when [enter] is clicked, to trigger data sending\n    $(document).on(\'keydown\', "#projectFiles table tbody td", function(e) {\n        if(e.which==13 && $(e.target).attr(\'contenteditable\')) {\n            e.preventDefault();\n            $(e.target).blur();\n        }\n    });\n    // blur when <select> changes value to trigger data sending\n    $("#projectFiles table tbody").on(\'change\', "select", function(e) {\n        $(e.target).blur();\n    });\n\n// Listen to changes in selected table row\n//----------------------------------------\n    // listen to changes in file selection by clicking on the file table\n    $(document).on(\'click touchstart\', "#projectFiles tbody tr",function() {\n        var table=$(this).closest("table");\n        var currentIndex=$(table).find("tr.selected").index();\n        var index=$(this).index();\n\n        if(index>=0 && currentIndex!=index) {\n            $(table).find("tr").removeClass("selected");\n            $(this).addClass("selected");\n            // remove table with previous annotations\n            $("table#volAnnotations tbody").html("");\n            // load and bind new file\n            loadProjectFile(index);\n        }\n    });\n\n    // listen to changes in file selection by pressing the up/down arrows\n    $(document).on(\'keydown\', function(e){\n        var table=$("#projectFiles tbody");\n        var index=$(table).find("tr.selected").index();\n    \n        if(e.keyCode!=38 && e.keyCode!=40)\n            return;\n\n        switch(e.keyCode) {\n            case 38: // up\n                index=(index+projectInfo.files.list.length-1)%projectInfo.files.list.length;\n                break;\n            case 40: // down\n                index=(index+1)%projectInfo.files.list.length;\n                break;\n        }\n        $(table).find("tr").removeClass("selected");\n        $(table).find("tr:eq("+index+")").addClass("selected");\n    \n        // remove table with previous annotations\n        $("table#volAnnotations tbody").html("");\n\n        // load and bind new file\n        loadProjectFile(index);\n    });\n\n    // listen to changes in selected volume annotation\n    $(document).on(\'click touchstart\', "#volAnnotations tbody tr", function () {\n        var table=$(this).closest("tbody");\n        var currentIndex=$(table).find("tr.selected").index();\n        var index=$(this).index();\n\n        if(index>=0 && currentIndex!=index) {\n            $(table).find("tr").removeClass("selected");\n            $(this).addClass("selected");\n    \n            var iarr,found=false;\n            for(iarr=0;iarr<BrainBox.info.mri.atlas.length;iarr++) {\n                if(BrainBox.info.mri.atlas[iarr].name==annotations.volume[index].name\n                    && BrainBox.info.mri.atlas[iarr].project==projectInfo.shortname) {\n                    found=true;\n                    break;\n                }\n            }\n            if(found)\n                AtlasMakerWidget.configureAtlasMaker(BrainBox.info,iarr);\n            else\n                console.log("ERROR: A quite unexpected one too...");\n        }\n    });\n\n// Functions\n//----------\nfunction queryFiles() {\n    $.getJSON("/project/json/"+projectInfo.shortname+"/files", {\n        start: projectInfo.files.list.length,\n        length: numFilesQuery\n    })\n    .then(function(list) {\n        if(list.length) {\n            appendFilesToProject(list);\n            queryFiles();\n        } else {\n            console.log("All files downloaded. Length:",projectInfo.files.list.length);\n        }\n    })\n}\nfunction appendFilesToProject(list) {\n    var i0, i, j;\n    \n    i0 = projectInfo.files.list.length;\n    projectInfo.files.list.push.apply(projectInfo.files.list, list);\n    \n    // make sure that all mri files have a text annotations object for the project\n    for(i=0;i<list.length;i++) {\n        file = projectInfo.files.list[i0+i];\n        if (!(file.mri)) {\n            file.mri = {};\n        }\n        if (!(file.mri.annotations)) {\n            file.mri.annotations = {};\n        }\n        if (!(file.mri.annotations[projShortname])) {\n            file.mri.annotations[projShortname] = {};\n        }\n    }\n    // initialise the relevant annotation entries in each mri file if required\n    for(i=0;i<list.length;i++) {\n        file = projectInfo.files.list[i0+i];\n        for(j=0;j<annotations.text.length;j++) {\n            annName = annotations.text[j].name;\n            if(!file.mri.annotations[projShortname][annName]) {\n                var date=new Date();\n                file.mri.annotations[projShortname][annName] = {\n                    created: date.toJSON(),\n                    modified: date.toJSON(),\n                    modifiedBy: AtlasMakerWidget.User.username,\n                    type: "text"\n                };\n            }\n        }\n    }\n    for(var i=0;i<list.length;i++) {\n        BrainBox.appendAnnotationTableRow(i0+i,aParam);\n    }\n}\n\n/**\n * @func loadProjectFile\n * @desc load a new mri from the project list\n */\nfunction loadProjectFile(index) {\n    return new Promise(function(resolve, reject) {\n        var url=projectInfo.files.list[index].source;\n        var params={url:url,view:"cor",slice:180,fullscreen:false};\n        $("#loadingIndicator p").text("Loading...");\n        $("#loadingIndicator").show();\n\n        /**\n         * @todo The mri entry may correspond to a file that has not been downloaded yet!\n         */\n        var info = projectInfo.files.list[index];\n\n        if($.isEmptyObject(info) === false) {\n            // check if the mri contains the required annotations\n            var irow; // index of the table row\n            var iarr; // index of the object in the data array\n            for(irow=0;irow<annotations.volume.length;irow++) {\n                found = false;\n                if(!info.mri.atlas)\n                    info.mri.atlas = [];\n                for(iarr=0;iarr<info.mri.atlas.length;iarr++) {\n                    if(annotations.volume[irow].name == info.mri.atlas[iarr].name\n                       && projectInfo.shortname == info.mri.atlas[iarr].project) {\n                        found=true;\n                        break;\n                    }\n                }\n                // if it doesn\'t, create them\n                if(found == false) {\n                    // add annotation\n                    var date=new Date();\n                    // add data to annotations array\n                    var atlas = {\n                        name: annotations.volume[irow].name,\n                        project: projectInfo.shortname,\n                        created: date.toJSON(),\n                        modified: date.toJSON(),\n                        modifiedBy: AtlasMakerWidget.User.username,\n                        filename: Math.random().toString(36).slice(2)+".nii.gz",\t// automatically generated filename\n                        labels: annotations.volume[irow].values,\n                        owner: AtlasMakerWidget.User.username,\n                        type: "volume"\n                    };\n\n                    projectInfo.files.list[index].mri.atlas.push(atlas);\n                }\n\n                annotations.volume[irow].annotationItemIndex=iarr;\n            }\n            params.info=projectInfo.files.list[index];\n\n            if(annotations.volume[0]) {\n                params.annotationItemIndex = annotations.volume[0].annotationItemIndex;\n            } else {\n                params.annotationItemIndex = -1;\n            }\n\n            BrainBox.configureBrainBox(params)\n            .then(function from_project(){\n\n                // bind volume annotations to table#volAnnotations\n                var annvol_proxy={};\n                var aParam = {\n                    table: $("table#volAnnotations"),\n                    info_proxy: annvol_proxy,\n                    info: BrainBox.info,\n                    trTemplate: $.map([\n                        "<tr>",\n                        " <td></td>",           // volume name\n                        " <td></td>",\t        // volume label set\n                        "</tr>"],function(o){return o}).join(),\n                    objTemplate: [\n                        {\ttypeOfBinding:1,\n                            path:"mri.atlas.#.name"\n                        },\n                        {\ttypeOfBinding:1,\n                            path:"mri.atlas.#.labels"\n                        }\n                    ]\n                };\n\n                // add and bind new table row\n                for(irow=0;irow<annotations.volume.length;irow++) {\n                    BrainBox.appendAnnotationTableRow2(irow,annotations.volume[irow].annotationItemIndex,aParam);\n                }\n                // update in server\n                saveAnnotations(aParam);\n\n                // select the first annotation by default\n                // (should be read from project settings)\n                $("#annotations tbody tr:eq(0)").addClass("selected");\n\n                AtlasMakerWidget.User.projectPage = projectInfo.shortname;\n                AtlasMakerWidget.sendUserDataMessage(JSON.stringify({projectPage:projectInfo.shortname}));\n\n                resolve();\n            });\n        } else {\n            var msg=AtlasMakerWidget.container.find("#text-layer");\n            msg.html("<text x=\'5\' y=\'15\' fill=\'white\'>ERROR: File is unreadable</text>");\n            console.log("ERROR: Cannot read data. The file is maybe corrupt?");\n\n            reject();\n        }\n    });\n}\n/**\n * @func saveAnnotations\n * @desc Save annotations if they have changed\n */\nfunction saveAnnotations(param) {\n    JSON.stringify(param.info_proxy); // update BrainBox.info from info_proxy\n    AtlasMakerWidget.sendSaveMetadataMessage(BrainBox.info);\n    hashOld = BrainBox.hash(JSON.stringify(BrainBox.info));\n}\n/**\n * @func resizeButton\n * @desc Resize left tool bar\n */\nfunction resizeButton(p) {\n    if($("#resizeButton").data("flag")==0) {\n        $("#resizeButton").data({flag:1,x0:p.x,y0:p.y});\n    } else if($("#resizeButton").data("flag")==1) {\n        var d=$("#resizeButton").data("x0")-p.x;\n        $("#left").css({\'flex-basis\':$("#left").width()-d});\n        $("#resizeButton").data({x0:p.x,y0:p.y});\n        AtlasMakerWidget.resizeWindow();\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi92aWV3L2JyYWluYm94L3NyYy9wYWdlcy9wcm9qZWN0LXBhZ2UuanM/ODAwYyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUE0QztBQUNKO0FBQ0k7O0FBRTVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDO0FBQy9DLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBLFFBQVEsc0NBQXNDO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNDQUFzQztBQUM5QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSx5QkFBeUIsa0JBQWtCO0FBQzNDLHlEQUF5RCxjQUFjLDZCQUE2QixFQUFFO0FBQ3RHLHFDQUFxQyxjQUFjLG9CQUFvQixFQUFFO0FBQ3pFLHFDQUFxQyxjQUFjLG9GQUFvRixFQUFFO0FBQ3pJLDRDQUE0Qyx5QkFBeUIsUUFBUSxFQUFFOztBQUUvRSxrQ0FBa0Msd0JBQXdCO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsNkNBQTZDOztBQUV2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMkJBQTJCO0FBQzNDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQixRQUFRLEdBQUcsMEVBQVE7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EscUJBQXFCLFFBQVEsR0FBRywwRUFB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S0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMscUJBQXFCO0FBQ3RELEtBQUs7QUFDTDtBQUNBLHdCQUF3QixrQ0FBa0M7QUFDMUQsaUNBQWlDLGNBQWM7QUFDL0M7QUFDQTtBQUNBIiwiZmlsZSI6IjYuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnJlZWZvcm0gZnJvbSAnLi4vdG9vbHMvZnJlZWZvcm0uanMnO1xuaW1wb3J0IGhpZGRlbiBmcm9tICcuLi90b29scy9oaWRkZW4uanMnO1xuaW1wb3J0IG11bHRpcGxlIGZyb20gJy4uL3Rvb2xzL211bHRpcGxlLmpzJztcblxuY29uc3QgcHJvalNob3J0bmFtZSA9IHByb2plY3RJbmZvLnNob3J0bmFtZTtcbmNvbnN0IG51bUZpbGVzUXVlcnkgPSAyMDtcbmNvbnN0IGFubm90YXRpb25zID0ge1xuICAgIHRleHQ6IFtdLCAgIC8vIGNvbGxlY3QgdGV4dCBhbm5vdGF0aW9uc1xuICAgIHZvbHVtZTogW10gIC8vIGNvbGxlY3Qgdm9sdW1lIGFubm90YXRpb25zXG59O1xubGV0IGssIGgsIHN0ciwgZm91bmQsIGFublR5cGUsIGFubk5hbWUsIGZpbGU7XG5sZXQgdHJUZW1wbGF0ZTtcbmxldCBvYmpUZW1wbGF0ZTtcbmxldCBhUGFyYW07XG5sZXQgaGFzaE9sZDtcblxuXG4vLyBQcmV2ZW50IHpvb20gb24gZG91YmxlIHRhcFxuJCgnYm9keScpLm9uKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24gcHJldmVudFpvb20oZSkge1xuICAgIHZhciB0MiA9IGUudGltZVN0YW1wXG4gICAgICAsIHQxID0gJCh0aGlzKS5kYXRhKCdsYXN0VG91Y2gnKSB8fCB0MlxuICAgICAgLCBkdCA9IHQyIC0gdDFcbiAgICAgICwgZmluZ2VycyA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzLmxlbmd0aDtcbiAgICAkKHRoaXMpLmRhdGEoJ2xhc3RUb3VjaCcsIHQyKTtcbiAgICBpZiAoIWR0IHx8IGR0ID4gNTAwIHx8IGZpbmdlcnMgPiAxKSByZXR1cm47IC8vIG5vdCBkb3VibGUtdGFwXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpOyAvLyBkb3VibGUgdGFwIC0gcHJldmVudCB0aGUgem9vbVxuICAgIC8vIGFsc28gc3ludGhlc2l6ZSBjbGljayBldmVudHMgd2UganVzdCBzd2FsbG93ZWQgdXBcbiAgICAkKHRoaXMpLnRyaWdnZXIoJ2NsaWNrJykudHJpZ2dlcignY2xpY2snKTtcbn0pO1xuXG4vLyBjb2xsZWN0IHRoZSBwcm9qZWN0J3MgdGV4dCBhbm5vdGF0aW9uc1xuZm9yKGs9MDtrPHByb2plY3RJbmZvLmFubm90YXRpb25zLmxpc3QubGVuZ3RoO2srKykge1xuICAgIGlmIChwcm9qZWN0SW5mby5hbm5vdGF0aW9ucy5saXN0W2tdLnR5cGUgPT09IFwidGV4dFwiIHxcbiAgICAgICAgcHJvamVjdEluZm8uYW5ub3RhdGlvbnMubGlzdFtrXS50eXBlID09PSBcImhpZGRlbiB0ZXh0XCIgfFxuICAgICAgICBwcm9qZWN0SW5mby5hbm5vdGF0aW9ucy5saXN0W2tdLnR5cGUgPT09IFwibXVsdGlwbGUgY2hvaWNlc1wiKSB7XG4gICAgICAgICQoXCIjcHJvamVjdEZpbGVzIHRoZWFkIHRyXCIpLmFwcGVuZChcIjx0aD5cIiArIHByb2plY3RJbmZvLmFubm90YXRpb25zLmxpc3Rba10ubmFtZSArIFwiPC90aD5cIik7XG4gICAgICAgIGFubm90YXRpb25zLnRleHQucHVzaChwcm9qZWN0SW5mby5hbm5vdGF0aW9ucy5saXN0W2tdKTtcbiAgICB9XG59XG4vLyBjb2xsZWN0IHRoZSBwcm9qZWN0J3Mgdm9sdW1lIGFubm90YXRpb25zXG5mb3Ioaz0wO2s8cHJvamVjdEluZm8uYW5ub3RhdGlvbnMubGlzdC5sZW5ndGg7aysrKSB7XG4gICAgaWYgKHByb2plY3RJbmZvLmFubm90YXRpb25zLmxpc3Rba10udHlwZSA9PT0gXCJ2b2x1bWVcIikge1xuICAgICAgICBhbm5vdGF0aW9ucy52b2x1bWUucHVzaChwcm9qZWN0SW5mby5hbm5vdGF0aW9ucy5saXN0W2tdKTtcbiAgICB9XG59XG5cbiQoXCIjcHJvamVjdE5hbWVcIikudGV4dChwcm9qZWN0SW5mby5uYW1lKTtcblxuJChcIiNyZXNpemVCdXR0b25cIikuZGF0YSh7ZmxhZzotMSx4MDowLHkwOjB9KTtcbiQoXCIjcmVzaXplQnV0dG9uXCIpLm9uKCdtb3VzZWRvd24gdG91Y2hzdGFydCcsZnVuY3Rpb24oZSl7JCh0aGlzKS5kYXRhKHtmbGFnOjAseDA6ZS5wYWdlWCx5MDplLnBhZ2VZfSl9KTtcbiQoXCJib2R5XCIpLm9uKCdtb3VzZW1vdmUnLGZ1bmN0aW9uKGUpe3Jlc2l6ZUJ1dHRvbih7eDplLnBhZ2VYLHk6ZS5wYWdlWX0pfSk7XG4kKFwiYm9keVwiKS5vbigndG91Y2htb3ZlJyxmdW5jdGlvbihlKXtyZXNpemVCdXR0b24oe3g6ZS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYLHk6ZS5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZfSl9KTtcbiQoXCJib2R5XCIpLm9uKCdtb3VzZXVwIHRvdWNoZW5kJyxmdW5jdGlvbihlKXskKFwiI3Jlc2l6ZUJ1dHRvblwiKS5kYXRhKHtmbGFnOi0xfSl9KTtcblxuJChcIiNhZGRQcm9qZWN0XCIpLmNsaWNrKGZ1bmN0aW9uKCl7bG9jYXRpb249XCIvcHJvamVjdC9uZXdcIn0pO1xuJChcIiNzZXR0aW5nc1wiKS5jbGljayhmdW5jdGlvbigpe1xuICAgIHZhciBwYXRobmFtZT1sb2NhdGlvbi5wYXRobmFtZTtcbiAgICBpZihwYXRobmFtZS5zbGljZSgtMSk9PVwiL1wiKVxuICAgICAgICBsb2NhdGlvbj1wYXRobmFtZStcInNldHRpbmdzXCI7XG4gICAgZWxzZVxuICAgICAgICBsb2NhdGlvbj1wYXRobmFtZStcIi9zZXR0aW5nc1wiO1xufSk7XG5cblxuLy8gSW5pdCBCcmFpbkJveFxuLy8tLS0tLS0tLS0tLS0tLS1cbiAgICBCcmFpbkJveC5pbml0QnJhaW5Cb3goKVxuICAgIC50aGVuKGZ1bmN0aW9uIGZyb21fcHJvamVjdCgpe1xuICAgICAgICByZXR1cm4gQnJhaW5Cb3gubG9hZExhYmVsc2V0cygpO1xuICAgIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBCaW5kIHRoZSBwcm9qZWN0J3MgZmlsZXMgdG8gdGhlIHRhYmxlIHdpdGhpbiAjcHJvamVjdEZpbGVzXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHRyVGVtcGxhdGUgPSBbJzx0cj4nXTtcbiAgICAgICAgb2JqVGVtcGxhdGUgPSBbXTtcblxuICAgICAgICAvLyBjb25maWd1cmUgdGhlIGJpbmRpbmcgdGVtcGxhdGUgZm9yIHRhYmxlIHJvdyBhbmQgb2JqZWN0LlxuICAgICAgICAvLyB0aGUgMXN0IHR3byBjb2x1bW5zIGFyZSBmaXhlZDogbmFtZSBhbmQgc291cmNlXG4gICAgICAgIHRyVGVtcGxhdGUucHVzaChbXCI8dGQgY29udGVudEVkaXRhYmxlPXRydWUgY2xhc3M9J25vRW1wdHknPjwvdGQ+XCJdKTtcbiAgICAgICAgb2JqVGVtcGxhdGUucHVzaCh7IHR5cGVPZkJpbmRpbmc6IDIsIHBhdGg6IFwiZmlsZXMubGlzdC4jLm5hbWVcIn0pO1xuXG4gICAgICAgIHRyVGVtcGxhdGUucHVzaChbXCI8dGQ+PGE+PC9hPjwvdGQ+XCJdKTtcbiAgICAgICAgb2JqVGVtcGxhdGUucHVzaCh7XG4gICAgICAgICAgICB0eXBlT2ZCaW5kaW5nOjEsXG4gICAgICAgICAgICBwYXRoOlwiZmlsZXMubGlzdC4jLnNvdXJjZVwiLFxuICAgICAgICAgICAgZm9ybWF0OmZ1bmN0aW9uKGUsIGQpe1xuICAgICAgICAgICAgICAgICQoZSkuZmluZChcImFcIikucHJvcChcImhyZWZcIiwgbG9jYXRpb24ub3JpZ2luK1wiL21yaT91cmw9XCIgKyBkKTtcbiAgICAgICAgICAgICAgICAkKGUpLmZpbmQoXCJhXCIpLmh0bWwoZC5zcGxpdChcIi9cIikucG9wKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyB0aGUgZm9sbG93aW5nIGNvbHVtbnMgYXJlIGNvbXBsZXRlZCBmcm9tIHRoZSBwcm9qZWN0J3MgJ2Fubm90YXRpb25zJyBkZWZpbml0aW9uczpcbiAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZWlyIHR5cGUgb2YgZGlzcGxheSAoZWl0aGVyIHNlbGVjdCBvciBmcmVlZm9ybSBhdCB0aGUgbW9tZW50KSBiYXNlZCBkYXRhIHR5cGVcbiAgICAgICAgbGV0IGc7XG4gICAgICAgIGZvcihnPTA7IGc8YW5ub3RhdGlvbnMudGV4dC5sZW5ndGg7IGcrKykge1xuICAgICAgICAgICAgYW5uVHlwZSA9IGFubm90YXRpb25zLnRleHRbZ10udHlwZTtcbiAgICAgICAgICAgIGFubk5hbWUgPSBhbm5vdGF0aW9ucy50ZXh0W2ddLm5hbWU7XG5cbiAgICAgICAgICAgIGlmKGFublR5cGUgPT09IFwibXVsdGlwbGUgY2hvaWNlc1wiKSB7XG4gICAgICAgICAgICAgICAgLy8gYXJyYXkgb2YgdmFsdWVzXG4gICAgICAgICAgICAgICAgbGV0IHt0ZCwgb2JqfSA9IG11bHRpcGxlKFxuICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9ucy50ZXh0W2ddLFxuICAgICAgICAgICAgICAgICAgICBcImZpbGVzLmxpc3QuIy5tcmkuYW5ub3RhdGlvbnMuXCIgKyBwcm9qU2hvcnRuYW1lICsgXCIuXCIgKyBhbm5OYW1lLFxuICAgICAgICAgICAgICAgICAgICBBdGxhc01ha2VyV2lkZ2V0LlVzZXIudXNlcm5hbWVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHRyVGVtcGxhdGUucHVzaCh0ZCk7XG4gICAgICAgICAgICAgICAgb2JqVGVtcGxhdGUucHVzaChvYmopO1xuICAgICAgICAgICAgfSBlbHNlIGlmKGFublR5cGUgPT09IFwidGV4dFwiKSB7XG4gICAgICAgICAgICAgICAgLy8gZnJlZWZvcm0gdGV4dFxuICAgICAgICAgICAgICAgIGxldCB7dGQsIG9ian0gPSBmcmVlZm9ybShcbiAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvbnMudGV4dFtnXSxcbiAgICAgICAgICAgICAgICAgICAgXCJmaWxlcy5saXN0LiMubXJpLmFubm90YXRpb25zLlwiICsgcHJvalNob3J0bmFtZSArIFwiLlwiICsgYW5uTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgQXRsYXNNYWtlcldpZGdldC5Vc2VyLnVzZXJuYW1lXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0clRlbXBsYXRlLnB1c2godGQpO1xuICAgICAgICAgICAgICAgIG9ialRlbXBsYXRlLnB1c2gob2JqKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZihhbm5UeXBlID09PSBcImhpZGRlbiB0ZXh0XCIpIHtcbiAgICAgICAgICAgICAgICAvLyBmcmVlZm9ybSB0ZXh0XG4gICAgICAgICAgICAgICAgbGV0IHt0ZCwgb2JqfSA9IGhpZGRlbihcbiAgICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvbnMudGV4dFtnXSxcbiAgICAgICAgICAgICAgICAgICAgXCJmaWxlcy5saXN0LiMubXJpLmFubm90YXRpb25zLlwiICsgcHJvalNob3J0bmFtZSArIFwiLlwiICsgYW5uTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgQXRsYXNNYWtlcldpZGdldC5Vc2VyLnVzZXJuYW1lXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0clRlbXBsYXRlLnB1c2godGQpO1xuICAgICAgICAgICAgICAgIG9ialRlbXBsYXRlLnB1c2gob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQHRvZG8gVGhpcyBpcyB0aGUgcGxhY2Ugd2hlcmUgJ3Bvc2l0aW9uJyBvciAnbGVuZ3RoJyBhbm5vdGF0aW9ucyBzaG91bGQgYmUgYWRkZWRcbiAgICAgICAgICAgICAqL1xuICAgICAgICB9XG4gICAgICAgIHRyVGVtcGxhdGUucHVzaChcIjwvdHI+XCIpO1xuICAgICAgICBhUGFyYW0gPSB7XG4gICAgICAgICAgICB0YWJsZTogJChcIiNwcm9qZWN0RmlsZXMgdGFibGVcIiksXG4gICAgICAgICAgICBpbmZvX3Byb3h5OiBpbmZvX3Byb3h5LFxuICAgICAgICAgICAgaW5mbzogcHJvamVjdEluZm8sXG4gICAgICAgICAgICB0clRlbXBsYXRlOiB0clRlbXBsYXRlLmpvaW4oXCJcXG5cIiksXG4gICAgICAgICAgICBvYmpUZW1wbGF0ZTogb2JqVGVtcGxhdGVcbiAgICAgICAgfTtcbiAgICB9KVxuICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIC8vIEFwcGVuZCB0aGUgcHJvamVjdCBmaWxlcyBwcm9ncmVzc2l2ZWx5LiBTdGFydCB3aXRoIHRoZSAxc3QgI251bUZpbGVzUXVlcnkgZmlsZXMsIGxvYWQgYW5kXG4gICAgICAgIC8vIGRpc3BsYXkgdGhlIDFzdCBmaWxlLCBjb25maWd1cmUgdGhlIHRvb2xzIHBvc2l0aW9uLCBhbmQga2VlcCBxdWVyeWluZyBmb3IgdGhlXG4gICAgICAgIC8vIHJlc3Qgb2YgdGhlIGZpbGVzXG4gICAgICAgIHJldHVybiAkLmdldEpTT04oXCIvcHJvamVjdC9qc29uL1wiK3Byb2plY3RJbmZvLnNob3J0bmFtZStcIi9maWxlc1wiLCB7XG4gICAgICAgICAgICBzdGFydDogMCxcbiAgICAgICAgICAgIGxlbmd0aDogbnVtRmlsZXNRdWVyeVxuICAgICAgICB9KVxuICAgIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24obGlzdCkge1xuICAgICAgICBhcHBlbmRGaWxlc1RvUHJvamVjdChsaXN0KTtcbiAgICAgICAgXG4gICAgICAgIC8vIG1hcmsgZmlyc3Qgcm93IGFzIHNlbGVjdGVkXG4gICAgICAgICQoXCIjcHJvamVjdEZpbGVzIHRib2R5IHRyOmVxKDApXCIpLmFkZENsYXNzKFwic2VsZWN0ZWRcIik7XG4gICAgfSlcbiAgICAudGhlbihmdW5jdGlvbiBmcm9tX3Byb2plY3QoKXtyZXR1cm4gbG9hZFByb2plY3RGaWxlKDApfSlcbiAgICAudGhlbihmdW5jdGlvbiBmcm9tX3Byb2plY3QoKXtcbiAgICAgICAgJChcIiN0b29scy1zaWRlXCIpLmRldGFjaCgpLmFwcGVuZFRvKCcjdG9vbHMnKTtcbiAgICAgICAgLy8gY29ubmVjdCBjb2xvdXJzIGNsb3NlIGJ1dHRvblxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2sgdG91Y2hzdGFydCcsIFwiI2xhYmVscy1jbG9zZVwiLCBmdW5jdGlvbigpeyQoXCIjbGFiZWxzZXRcIikuaGlkZSgpfSk7XG4gICAgfSlcbiAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgcXVlcnlGaWxlcygpO1xuICAgIH0pXG4gICAgLmNhdGNoKCBlcnIgPT4ge1xuICAgICAgICAkKFwiI21zZ0xvZ1wiKS5odG1sKFwiRVJST1I6IENhbid0IGxvYWQgZGF0YS4gXCIgKyBlcnIpO1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSk7XG5cbi8vIExpc3RlbiB0byBjaGFuZ2VzIHRoYXQgdHJpZ2dlciBhIG1ldGFkYXRhIHNhdmVcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gc2VuZCBkYXRhIHdoZW4gZm9jdXMgaXMgbG9zdCAob24gYmx1cilcbiAgICAkKGRvY3VtZW50KS5vbignYmx1cicsIFwiI3Byb2plY3RGaWxlcyB0YWJsZSB0Ym9keSB0ZFwiLCBmdW5jdGlvbiBmcm9tX3Byb2plY3QoZSkge1xuICAgICAgICB2YXIgaW5kZXggPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLmluZGV4KCk7XG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGluZm9fcHJveHkpOyAvLyB1cGRhdGUgY29udGVudCBvZiBwcm9qZWN0SW5mbyBvYmplY3QgZnJvbSBwcm94eSBieSBjYWxsaW5nIGFsbCBnZXR0ZXJzXG4gICAgICAgIEF0bGFzTWFrZXJXaWRnZXQuc2VuZFNhdmVNZXRhZGF0YU1lc3NhZ2UocHJvamVjdEluZm8uZmlsZXMubGlzdFtpbmRleF0pO1xuICAgIH0pO1xuICAgIC8vIGJsdXIgd2hlbiBbZW50ZXJdIGlzIGNsaWNrZWQsIHRvIHRyaWdnZXIgZGF0YSBzZW5kaW5nXG4gICAgJChkb2N1bWVudCkub24oJ2tleWRvd24nLCBcIiNwcm9qZWN0RmlsZXMgdGFibGUgdGJvZHkgdGRcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICBpZihlLndoaWNoPT0xMyAmJiAkKGUudGFyZ2V0KS5hdHRyKCdjb250ZW50ZWRpdGFibGUnKSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJChlLnRhcmdldCkuYmx1cigpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gYmx1ciB3aGVuIDxzZWxlY3Q+IGNoYW5nZXMgdmFsdWUgdG8gdHJpZ2dlciBkYXRhIHNlbmRpbmdcbiAgICAkKFwiI3Byb2plY3RGaWxlcyB0YWJsZSB0Ym9keVwiKS5vbignY2hhbmdlJywgXCJzZWxlY3RcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAkKGUudGFyZ2V0KS5ibHVyKCk7XG4gICAgfSk7XG5cbi8vIExpc3RlbiB0byBjaGFuZ2VzIGluIHNlbGVjdGVkIHRhYmxlIHJvd1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gbGlzdGVuIHRvIGNoYW5nZXMgaW4gZmlsZSBzZWxlY3Rpb24gYnkgY2xpY2tpbmcgb24gdGhlIGZpbGUgdGFibGVcbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2sgdG91Y2hzdGFydCcsIFwiI3Byb2plY3RGaWxlcyB0Ym9keSB0clwiLGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdGFibGU9JCh0aGlzKS5jbG9zZXN0KFwidGFibGVcIik7XG4gICAgICAgIHZhciBjdXJyZW50SW5kZXg9JCh0YWJsZSkuZmluZChcInRyLnNlbGVjdGVkXCIpLmluZGV4KCk7XG4gICAgICAgIHZhciBpbmRleD0kKHRoaXMpLmluZGV4KCk7XG5cbiAgICAgICAgaWYoaW5kZXg+PTAgJiYgY3VycmVudEluZGV4IT1pbmRleCkge1xuICAgICAgICAgICAgJCh0YWJsZSkuZmluZChcInRyXCIpLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICAvLyByZW1vdmUgdGFibGUgd2l0aCBwcmV2aW91cyBhbm5vdGF0aW9uc1xuICAgICAgICAgICAgJChcInRhYmxlI3ZvbEFubm90YXRpb25zIHRib2R5XCIpLmh0bWwoXCJcIik7XG4gICAgICAgICAgICAvLyBsb2FkIGFuZCBiaW5kIG5ldyBmaWxlXG4gICAgICAgICAgICBsb2FkUHJvamVjdEZpbGUoaW5kZXgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBsaXN0ZW4gdG8gY2hhbmdlcyBpbiBmaWxlIHNlbGVjdGlvbiBieSBwcmVzc2luZyB0aGUgdXAvZG93biBhcnJvd3NcbiAgICAkKGRvY3VtZW50KS5vbigna2V5ZG93bicsIGZ1bmN0aW9uKGUpe1xuICAgICAgICB2YXIgdGFibGU9JChcIiNwcm9qZWN0RmlsZXMgdGJvZHlcIik7XG4gICAgICAgIHZhciBpbmRleD0kKHRhYmxlKS5maW5kKFwidHIuc2VsZWN0ZWRcIikuaW5kZXgoKTtcbiAgICBcbiAgICAgICAgaWYoZS5rZXlDb2RlIT0zOCAmJiBlLmtleUNvZGUhPTQwKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHN3aXRjaChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgMzg6IC8vIHVwXG4gICAgICAgICAgICAgICAgaW5kZXg9KGluZGV4K3Byb2plY3RJbmZvLmZpbGVzLmxpc3QubGVuZ3RoLTEpJXByb2plY3RJbmZvLmZpbGVzLmxpc3QubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA0MDogLy8gZG93blxuICAgICAgICAgICAgICAgIGluZGV4PShpbmRleCsxKSVwcm9qZWN0SW5mby5maWxlcy5saXN0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAkKHRhYmxlKS5maW5kKFwidHJcIikucmVtb3ZlQ2xhc3MoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgJCh0YWJsZSkuZmluZChcInRyOmVxKFwiK2luZGV4K1wiKVwiKS5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgIFxuICAgICAgICAvLyByZW1vdmUgdGFibGUgd2l0aCBwcmV2aW91cyBhbm5vdGF0aW9uc1xuICAgICAgICAkKFwidGFibGUjdm9sQW5ub3RhdGlvbnMgdGJvZHlcIikuaHRtbChcIlwiKTtcblxuICAgICAgICAvLyBsb2FkIGFuZCBiaW5kIG5ldyBmaWxlXG4gICAgICAgIGxvYWRQcm9qZWN0RmlsZShpbmRleCk7XG4gICAgfSk7XG5cbiAgICAvLyBsaXN0ZW4gdG8gY2hhbmdlcyBpbiBzZWxlY3RlZCB2b2x1bWUgYW5ub3RhdGlvblxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgXCIjdm9sQW5ub3RhdGlvbnMgdGJvZHkgdHJcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdGFibGU9JCh0aGlzKS5jbG9zZXN0KFwidGJvZHlcIik7XG4gICAgICAgIHZhciBjdXJyZW50SW5kZXg9JCh0YWJsZSkuZmluZChcInRyLnNlbGVjdGVkXCIpLmluZGV4KCk7XG4gICAgICAgIHZhciBpbmRleD0kKHRoaXMpLmluZGV4KCk7XG5cbiAgICAgICAgaWYoaW5kZXg+PTAgJiYgY3VycmVudEluZGV4IT1pbmRleCkge1xuICAgICAgICAgICAgJCh0YWJsZSkuZmluZChcInRyXCIpLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKFwic2VsZWN0ZWRcIik7XG4gICAgXG4gICAgICAgICAgICB2YXIgaWFycixmb3VuZD1mYWxzZTtcbiAgICAgICAgICAgIGZvcihpYXJyPTA7aWFycjxCcmFpbkJveC5pbmZvLm1yaS5hdGxhcy5sZW5ndGg7aWFycisrKSB7XG4gICAgICAgICAgICAgICAgaWYoQnJhaW5Cb3guaW5mby5tcmkuYXRsYXNbaWFycl0ubmFtZT09YW5ub3RhdGlvbnMudm9sdW1lW2luZGV4XS5uYW1lXG4gICAgICAgICAgICAgICAgICAgICYmIEJyYWluQm94LmluZm8ubXJpLmF0bGFzW2lhcnJdLnByb2plY3Q9PXByb2plY3RJbmZvLnNob3J0bmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZD10cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihmb3VuZClcbiAgICAgICAgICAgICAgICBBdGxhc01ha2VyV2lkZ2V0LmNvbmZpZ3VyZUF0bGFzTWFrZXIoQnJhaW5Cb3guaW5mbyxpYXJyKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVSUk9SOiBBIHF1aXRlIHVuZXhwZWN0ZWQgb25lIHRvby4uLlwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4vLyBGdW5jdGlvbnNcbi8vLS0tLS0tLS0tLVxuZnVuY3Rpb24gcXVlcnlGaWxlcygpIHtcbiAgICAkLmdldEpTT04oXCIvcHJvamVjdC9qc29uL1wiK3Byb2plY3RJbmZvLnNob3J0bmFtZStcIi9maWxlc1wiLCB7XG4gICAgICAgIHN0YXJ0OiBwcm9qZWN0SW5mby5maWxlcy5saXN0Lmxlbmd0aCxcbiAgICAgICAgbGVuZ3RoOiBudW1GaWxlc1F1ZXJ5XG4gICAgfSlcbiAgICAudGhlbihmdW5jdGlvbihsaXN0KSB7XG4gICAgICAgIGlmKGxpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICBhcHBlbmRGaWxlc1RvUHJvamVjdChsaXN0KTtcbiAgICAgICAgICAgIHF1ZXJ5RmlsZXMoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQWxsIGZpbGVzIGRvd25sb2FkZWQuIExlbmd0aDpcIixwcm9qZWN0SW5mby5maWxlcy5saXN0Lmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICB9KVxufVxuZnVuY3Rpb24gYXBwZW5kRmlsZXNUb1Byb2plY3QobGlzdCkge1xuICAgIHZhciBpMCwgaSwgajtcbiAgICBcbiAgICBpMCA9IHByb2plY3RJbmZvLmZpbGVzLmxpc3QubGVuZ3RoO1xuICAgIHByb2plY3RJbmZvLmZpbGVzLmxpc3QucHVzaC5hcHBseShwcm9qZWN0SW5mby5maWxlcy5saXN0LCBsaXN0KTtcbiAgICBcbiAgICAvLyBtYWtlIHN1cmUgdGhhdCBhbGwgbXJpIGZpbGVzIGhhdmUgYSB0ZXh0IGFubm90YXRpb25zIG9iamVjdCBmb3IgdGhlIHByb2plY3RcbiAgICBmb3IoaT0wO2k8bGlzdC5sZW5ndGg7aSsrKSB7XG4gICAgICAgIGZpbGUgPSBwcm9qZWN0SW5mby5maWxlcy5saXN0W2kwK2ldO1xuICAgICAgICBpZiAoIShmaWxlLm1yaSkpIHtcbiAgICAgICAgICAgIGZpbGUubXJpID0ge307XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEoZmlsZS5tcmkuYW5ub3RhdGlvbnMpKSB7XG4gICAgICAgICAgICBmaWxlLm1yaS5hbm5vdGF0aW9ucyA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGlmICghKGZpbGUubXJpLmFubm90YXRpb25zW3Byb2pTaG9ydG5hbWVdKSkge1xuICAgICAgICAgICAgZmlsZS5tcmkuYW5ub3RhdGlvbnNbcHJvalNob3J0bmFtZV0gPSB7fTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBpbml0aWFsaXNlIHRoZSByZWxldmFudCBhbm5vdGF0aW9uIGVudHJpZXMgaW4gZWFjaCBtcmkgZmlsZSBpZiByZXF1aXJlZFxuICAgIGZvcihpPTA7aTxsaXN0Lmxlbmd0aDtpKyspIHtcbiAgICAgICAgZmlsZSA9IHByb2plY3RJbmZvLmZpbGVzLmxpc3RbaTAraV07XG4gICAgICAgIGZvcihqPTA7ajxhbm5vdGF0aW9ucy50ZXh0Lmxlbmd0aDtqKyspIHtcbiAgICAgICAgICAgIGFubk5hbWUgPSBhbm5vdGF0aW9ucy50ZXh0W2pdLm5hbWU7XG4gICAgICAgICAgICBpZighZmlsZS5tcmkuYW5ub3RhdGlvbnNbcHJvalNob3J0bmFtZV1bYW5uTmFtZV0pIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0ZT1uZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgIGZpbGUubXJpLmFubm90YXRpb25zW3Byb2pTaG9ydG5hbWVdW2Fubk5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVkOiBkYXRlLnRvSlNPTigpLFxuICAgICAgICAgICAgICAgICAgICBtb2RpZmllZDogZGF0ZS50b0pTT04oKSxcbiAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRCeTogQXRsYXNNYWtlcldpZGdldC5Vc2VyLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInRleHRcIlxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZm9yKHZhciBpPTA7aTxsaXN0Lmxlbmd0aDtpKyspIHtcbiAgICAgICAgQnJhaW5Cb3guYXBwZW5kQW5ub3RhdGlvblRhYmxlUm93KGkwK2ksYVBhcmFtKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGZ1bmMgbG9hZFByb2plY3RGaWxlXG4gKiBAZGVzYyBsb2FkIGEgbmV3IG1yaSBmcm9tIHRoZSBwcm9qZWN0IGxpc3RcbiAqL1xuZnVuY3Rpb24gbG9hZFByb2plY3RGaWxlKGluZGV4KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgdXJsPXByb2plY3RJbmZvLmZpbGVzLmxpc3RbaW5kZXhdLnNvdXJjZTtcbiAgICAgICAgdmFyIHBhcmFtcz17dXJsOnVybCx2aWV3OlwiY29yXCIsc2xpY2U6MTgwLGZ1bGxzY3JlZW46ZmFsc2V9O1xuICAgICAgICAkKFwiI2xvYWRpbmdJbmRpY2F0b3IgcFwiKS50ZXh0KFwiTG9hZGluZy4uLlwiKTtcbiAgICAgICAgJChcIiNsb2FkaW5nSW5kaWNhdG9yXCIpLnNob3coKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQHRvZG8gVGhlIG1yaSBlbnRyeSBtYXkgY29ycmVzcG9uZCB0byBhIGZpbGUgdGhhdCBoYXMgbm90IGJlZW4gZG93bmxvYWRlZCB5ZXQhXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgaW5mbyA9IHByb2plY3RJbmZvLmZpbGVzLmxpc3RbaW5kZXhdO1xuXG4gICAgICAgIGlmKCQuaXNFbXB0eU9iamVjdChpbmZvKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBtcmkgY29udGFpbnMgdGhlIHJlcXVpcmVkIGFubm90YXRpb25zXG4gICAgICAgICAgICB2YXIgaXJvdzsgLy8gaW5kZXggb2YgdGhlIHRhYmxlIHJvd1xuICAgICAgICAgICAgdmFyIGlhcnI7IC8vIGluZGV4IG9mIHRoZSBvYmplY3QgaW4gdGhlIGRhdGEgYXJyYXlcbiAgICAgICAgICAgIGZvcihpcm93PTA7aXJvdzxhbm5vdGF0aW9ucy52b2x1bWUubGVuZ3RoO2lyb3crKykge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYoIWluZm8ubXJpLmF0bGFzKVxuICAgICAgICAgICAgICAgICAgICBpbmZvLm1yaS5hdGxhcyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvcihpYXJyPTA7aWFycjxpbmZvLm1yaS5hdGxhcy5sZW5ndGg7aWFycisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGFubm90YXRpb25zLnZvbHVtZVtpcm93XS5uYW1lID09IGluZm8ubXJpLmF0bGFzW2lhcnJdLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgJiYgcHJvamVjdEluZm8uc2hvcnRuYW1lID09IGluZm8ubXJpLmF0bGFzW2lhcnJdLnByb2plY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kPXRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBpZiBpdCBkb2Vzbid0LCBjcmVhdGUgdGhlbVxuICAgICAgICAgICAgICAgIGlmKGZvdW5kID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBhbm5vdGF0aW9uXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlPW5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBkYXRhIHRvIGFubm90YXRpb25zIGFycmF5XG4gICAgICAgICAgICAgICAgICAgIHZhciBhdGxhcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGFubm90YXRpb25zLnZvbHVtZVtpcm93XS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogcHJvamVjdEluZm8uc2hvcnRuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZDogZGF0ZS50b0pTT04oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkOiBkYXRlLnRvSlNPTigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRCeTogQXRsYXNNYWtlcldpZGdldC5Vc2VyLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpK1wiLm5paS5nelwiLFx0Ly8gYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgZmlsZW5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsczogYW5ub3RhdGlvbnMudm9sdW1lW2lyb3ddLnZhbHVlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyOiBBdGxhc01ha2VyV2lkZ2V0LlVzZXIudXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInZvbHVtZVwiXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdEluZm8uZmlsZXMubGlzdFtpbmRleF0ubXJpLmF0bGFzLnB1c2goYXRsYXMpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGFubm90YXRpb25zLnZvbHVtZVtpcm93XS5hbm5vdGF0aW9uSXRlbUluZGV4PWlhcnI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJhbXMuaW5mbz1wcm9qZWN0SW5mby5maWxlcy5saXN0W2luZGV4XTtcblxuICAgICAgICAgICAgaWYoYW5ub3RhdGlvbnMudm9sdW1lWzBdKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmFubm90YXRpb25JdGVtSW5kZXggPSBhbm5vdGF0aW9ucy52b2x1bWVbMF0uYW5ub3RhdGlvbkl0ZW1JbmRleDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmFubm90YXRpb25JdGVtSW5kZXggPSAtMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQnJhaW5Cb3guY29uZmlndXJlQnJhaW5Cb3gocGFyYW1zKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gZnJvbV9wcm9qZWN0KCl7XG5cbiAgICAgICAgICAgICAgICAvLyBiaW5kIHZvbHVtZSBhbm5vdGF0aW9ucyB0byB0YWJsZSN2b2xBbm5vdGF0aW9uc1xuICAgICAgICAgICAgICAgIHZhciBhbm52b2xfcHJveHk9e307XG4gICAgICAgICAgICAgICAgdmFyIGFQYXJhbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdGFibGU6ICQoXCJ0YWJsZSN2b2xBbm5vdGF0aW9uc1wiKSxcbiAgICAgICAgICAgICAgICAgICAgaW5mb19wcm94eTogYW5udm9sX3Byb3h5LFxuICAgICAgICAgICAgICAgICAgICBpbmZvOiBCcmFpbkJveC5pbmZvLFxuICAgICAgICAgICAgICAgICAgICB0clRlbXBsYXRlOiAkLm1hcChbXG4gICAgICAgICAgICAgICAgICAgICAgICBcIjx0cj5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiIDx0ZD48L3RkPlwiLCAgICAgICAgICAgLy8gdm9sdW1lIG5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiIDx0ZD48L3RkPlwiLFx0ICAgICAgICAvLyB2b2x1bWUgbGFiZWwgc2V0XG4gICAgICAgICAgICAgICAgICAgICAgICBcIjwvdHI+XCJdLGZ1bmN0aW9uKG8pe3JldHVybiBvfSkuam9pbigpLFxuICAgICAgICAgICAgICAgICAgICBvYmpUZW1wbGF0ZTogW1xuICAgICAgICAgICAgICAgICAgICAgICAge1x0dHlwZU9mQmluZGluZzoxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6XCJtcmkuYXRsYXMuIy5uYW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHR0eXBlT2ZCaW5kaW5nOjEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDpcIm1yaS5hdGxhcy4jLmxhYmVsc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8gYWRkIGFuZCBiaW5kIG5ldyB0YWJsZSByb3dcbiAgICAgICAgICAgICAgICBmb3IoaXJvdz0wO2lyb3c8YW5ub3RhdGlvbnMudm9sdW1lLmxlbmd0aDtpcm93KyspIHtcbiAgICAgICAgICAgICAgICAgICAgQnJhaW5Cb3guYXBwZW5kQW5ub3RhdGlvblRhYmxlUm93Mihpcm93LGFubm90YXRpb25zLnZvbHVtZVtpcm93XS5hbm5vdGF0aW9uSXRlbUluZGV4LGFQYXJhbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBpbiBzZXJ2ZXJcbiAgICAgICAgICAgICAgICBzYXZlQW5ub3RhdGlvbnMoYVBhcmFtKTtcblxuICAgICAgICAgICAgICAgIC8vIHNlbGVjdCB0aGUgZmlyc3QgYW5ub3RhdGlvbiBieSBkZWZhdWx0XG4gICAgICAgICAgICAgICAgLy8gKHNob3VsZCBiZSByZWFkIGZyb20gcHJvamVjdCBzZXR0aW5ncylcbiAgICAgICAgICAgICAgICAkKFwiI2Fubm90YXRpb25zIHRib2R5IHRyOmVxKDApXCIpLmFkZENsYXNzKFwic2VsZWN0ZWRcIik7XG5cbiAgICAgICAgICAgICAgICBBdGxhc01ha2VyV2lkZ2V0LlVzZXIucHJvamVjdFBhZ2UgPSBwcm9qZWN0SW5mby5zaG9ydG5hbWU7XG4gICAgICAgICAgICAgICAgQXRsYXNNYWtlcldpZGdldC5zZW5kVXNlckRhdGFNZXNzYWdlKEpTT04uc3RyaW5naWZ5KHtwcm9qZWN0UGFnZTpwcm9qZWN0SW5mby5zaG9ydG5hbWV9KSk7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBtc2c9QXRsYXNNYWtlcldpZGdldC5jb250YWluZXIuZmluZChcIiN0ZXh0LWxheWVyXCIpO1xuICAgICAgICAgICAgbXNnLmh0bWwoXCI8dGV4dCB4PSc1JyB5PScxNScgZmlsbD0nd2hpdGUnPkVSUk9SOiBGaWxlIGlzIHVucmVhZGFibGU8L3RleHQ+XCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJFUlJPUjogQ2Fubm90IHJlYWQgZGF0YS4gVGhlIGZpbGUgaXMgbWF5YmUgY29ycnVwdD9cIik7XG5cbiAgICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4vKipcbiAqIEBmdW5jIHNhdmVBbm5vdGF0aW9uc1xuICogQGRlc2MgU2F2ZSBhbm5vdGF0aW9ucyBpZiB0aGV5IGhhdmUgY2hhbmdlZFxuICovXG5mdW5jdGlvbiBzYXZlQW5ub3RhdGlvbnMocGFyYW0pIHtcbiAgICBKU09OLnN0cmluZ2lmeShwYXJhbS5pbmZvX3Byb3h5KTsgLy8gdXBkYXRlIEJyYWluQm94LmluZm8gZnJvbSBpbmZvX3Byb3h5XG4gICAgQXRsYXNNYWtlcldpZGdldC5zZW5kU2F2ZU1ldGFkYXRhTWVzc2FnZShCcmFpbkJveC5pbmZvKTtcbiAgICBoYXNoT2xkID0gQnJhaW5Cb3guaGFzaChKU09OLnN0cmluZ2lmeShCcmFpbkJveC5pbmZvKSk7XG59XG4vKipcbiAqIEBmdW5jIHJlc2l6ZUJ1dHRvblxuICogQGRlc2MgUmVzaXplIGxlZnQgdG9vbCBiYXJcbiAqL1xuZnVuY3Rpb24gcmVzaXplQnV0dG9uKHApIHtcbiAgICBpZigkKFwiI3Jlc2l6ZUJ1dHRvblwiKS5kYXRhKFwiZmxhZ1wiKT09MCkge1xuICAgICAgICAkKFwiI3Jlc2l6ZUJ1dHRvblwiKS5kYXRhKHtmbGFnOjEseDA6cC54LHkwOnAueX0pO1xuICAgIH0gZWxzZSBpZigkKFwiI3Jlc2l6ZUJ1dHRvblwiKS5kYXRhKFwiZmxhZ1wiKT09MSkge1xuICAgICAgICB2YXIgZD0kKFwiI3Jlc2l6ZUJ1dHRvblwiKS5kYXRhKFwieDBcIiktcC54O1xuICAgICAgICAkKFwiI2xlZnRcIikuY3NzKHsnZmxleC1iYXNpcyc6JChcIiNsZWZ0XCIpLndpZHRoKCktZH0pO1xuICAgICAgICAkKFwiI3Jlc2l6ZUJ1dHRvblwiKS5kYXRhKHt4MDpwLngseTA6cC55fSk7XG4gICAgICAgIEF0bGFzTWFrZXJXaWRnZXQucmVzaXplV2luZG93KCk7XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///6\n')}]);